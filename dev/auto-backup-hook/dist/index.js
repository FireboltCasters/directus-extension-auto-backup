"use strict";var n=require("fs"),e=require("path");function t(n){return n&&"object"==typeof n&&"default"in n?n:{default:n}}var i=t(n),a=t(e);function r(n){if(n.__esModule)return n;var e=Object.defineProperty({},"__esModule",{value:!0});return Object.keys(n).forEach((function(t){var i=Object.getOwnPropertyDescriptor(n,t);Object.defineProperty(e,t,i.get?i:{enumerable:!0,get:function(){return n[t]}})})),e}const l=class{constructor(n,e,t){this.services=n,this.database=e,this.schema=t}getItemsService(n){const{ItemsService:e}=this.services;return new e(n,{accountability:null,knex:this.database,schema:this.schema})}};var o=class n{static TABLENAME="auto_backup_settings";constructor(n,e,t){this.database=e,this.itemsServiceCreator=new l(n,e,t)}async init(){this.translationSettingsService=await this.itemsServiceCreator.getItemsService(n.TABLENAME)}async setSettings(n){let e=await this.getSettings();e&&e?.id&&await this.translationSettingsService.updateOne(e?.id,n)}async getActiveStatus(){return(await this.getSettings())?.active}async getState(){return(await this.getSettings())?.state}async getDBClient(){return(await this.getSettings())?.DB_CLIENT||"sqlite3"}isSQLITE3DBClient(n){return"sqlite3"===n}async getBackupLocationType(){return(await this.getSettings())?.backup_location_type||"file_library"}isBackupLocationTypeFileLibrary(n){return"file_library"===n}async getBackupLocationFileLibraryFolderName(){return(await this.getSettings())?.backup_location_folder_name||"backups"}async setBackupLocationFileLibraryFolderName(n){await this.setSettings({backup_location_folder_name:n})}async getBackupLocationFileLibraryFolderID(){return(await this.getSettings())?.backup_location_folder_id}async getBackupFileFormatPrefix(){let n=(await this.getSettings())?.backup_file_format_prefix;return null==n?"backup-":n||""}async getBackupFileFormatPostfix(){return(await this.getSettings())?.backup_file_format_postfix||""}async getBackupFileFormat(){let n=(await this.getSettings())?.backup_file_format;return null==n?"YYYY-MM-DD-HH-mm-ss-SSS":n||""}async setBackupLocationFileLibraryFolderID(n){await this.setSettings({backup_location_folder_id:n})}isBackupLocationTypeCustomPath(n){return"custom_path"===n}async getBackupLocationCustomPath(){return(await this.getSettings())?.backup_location_custom_path}async getSQLITE3DBFilename(){let n=(await this.getSettings())?.sqlite3_db_filename;return n||"/directus/database/data.db"}async setCurrentState(n){await this.setSettings({state:n})}async setLatestLog(n){await this.setSettings({latest_log:n})}async getSettings(){let n=await this.translationSettingsService.readByQuery({});return n&&n.length>0?n[0]:null}async isAutoBackupEnabled(){return(await this.getSettings())?.active}},s={},u={},c={};function d(n){return null==n}function p(n,e){var t="",i=n.reason||"(unknown reason)";return n.mark?(n.mark.name&&(t+='in "'+n.mark.name+'" '),t+="("+(n.mark.line+1)+":"+(n.mark.column+1)+")",!e&&n.mark.snippet&&(t+="\n\n"+n.mark.snippet),i+" "+t):i}function f(n,e){Error.call(this),this.name="YAMLException",this.reason=n,this.mark=e,this.message=p(this,!1),Error.captureStackTrace?Error.captureStackTrace(this,this.constructor):this.stack=(new Error).stack||""}c.isNothing=d,c.isObject=function(n){return"object"==typeof n&&null!==n},c.toArray=function(n){return Array.isArray(n)?n:d(n)?[]:[n]},c.repeat=function(n,e){var t,i="";for(t=0;t<e;t+=1)i+=n;return i},c.isNegativeZero=function(n){return 0===n&&Number.NEGATIVE_INFINITY===1/n},c.extend=function(n,e){var t,i,a,r;if(e)for(t=0,i=(r=Object.keys(e)).length;t<i;t+=1)n[a=r[t]]=e[a];return n},f.prototype=Object.create(Error.prototype),f.prototype.constructor=f,f.prototype.toString=function(n){return this.name+": "+p(this,n)};var h=f,g=c;function m(n,e,t,i,a){var r="",l="",o=Math.floor(a/2)-1;return i-e>o&&(e=i-o+(r=" ... ").length),t-i>o&&(t=i+o-(l=" ...").length),{str:r+n.slice(e,t).replace(/\t/g,"â†’")+l,pos:i-e+r.length}}function _(n,e){return g.repeat(" ",e-n.length)+n}var y=function(n,e){if(e=Object.create(e||null),!n.buffer)return null;e.maxLength||(e.maxLength=79),"number"!=typeof e.indent&&(e.indent=1),"number"!=typeof e.linesBefore&&(e.linesBefore=3),"number"!=typeof e.linesAfter&&(e.linesAfter=2);for(var t,i=/\r?\n|\r|\0/g,a=[0],r=[],l=-1;t=i.exec(n.buffer);)r.push(t.index),a.push(t.index+t[0].length),n.position<=t.index&&l<0&&(l=a.length-2);l<0&&(l=a.length-1);var o,s,u="",c=Math.min(n.line+e.linesAfter,r.length).toString().length,d=e.maxLength-(e.indent+c+3);for(o=1;o<=e.linesBefore&&!(l-o<0);o++)s=m(n.buffer,a[l-o],r[l-o],n.position-(a[l]-a[l-o]),d),u=g.repeat(" ",e.indent)+_((n.line-o+1).toString(),c)+" | "+s.str+"\n"+u;for(s=m(n.buffer,a[l],r[l],n.position,d),u+=g.repeat(" ",e.indent)+_((n.line+1).toString(),c)+" | "+s.str+"\n",u+=g.repeat("-",e.indent+c+3+s.pos)+"^\n",o=1;o<=e.linesAfter&&!(l+o>=r.length);o++)s=m(n.buffer,a[l+o],r[l+o],n.position-(a[l]-a[l+o]),d),u+=g.repeat(" ",e.indent)+_((n.line+o+1).toString(),c)+" | "+s.str+"\n";return u.replace(/\n$/,"")},b=h,v=["kind","multi","resolve","construct","instanceOf","predicate","represent","representName","defaultStyle","styleAliases"],w=["scalar","sequence","mapping"];var k=function(n,e){if(e=e||{},Object.keys(e).forEach((function(e){if(-1===v.indexOf(e))throw new b('Unknown option "'+e+'" is met in definition of "'+n+'" YAML type.')})),this.options=e,this.tag=n,this.kind=e.kind||null,this.resolve=e.resolve||function(){return!0},this.construct=e.construct||function(n){return n},this.instanceOf=e.instanceOf||null,this.predicate=e.predicate||null,this.represent=e.represent||null,this.representName=e.representName||null,this.defaultStyle=e.defaultStyle||null,this.multi=e.multi||!1,this.styleAliases=function(n){var e={};return null!==n&&Object.keys(n).forEach((function(t){n[t].forEach((function(n){e[String(n)]=t}))})),e}(e.styleAliases||null),-1===w.indexOf(this.kind))throw new b('Unknown kind "'+this.kind+'" is specified for "'+n+'" YAML type.')},x=h,S=k;function C(n,e){var t=[];return n[e].forEach((function(n){var e=t.length;t.forEach((function(t,i){t.tag===n.tag&&t.kind===n.kind&&t.multi===n.multi&&(e=i)})),t[e]=n})),t}function T(n){return this.extend(n)}T.prototype.extend=function(n){var e=[],t=[];if(n instanceof S)t.push(n);else if(Array.isArray(n))t=t.concat(n);else{if(!n||!Array.isArray(n.implicit)&&!Array.isArray(n.explicit))throw new x("Schema.extend argument should be a Type, [ Type ], or a schema definition ({ implicit: [...], explicit: [...] })");n.implicit&&(e=e.concat(n.implicit)),n.explicit&&(t=t.concat(n.explicit))}e.forEach((function(n){if(!(n instanceof S))throw new x("Specified list of YAML types (or a single Type object) contains a non-Type object.");if(n.loadKind&&"scalar"!==n.loadKind)throw new x("There is a non-scalar type in the implicit list of a schema. Implicit resolving of such types is not supported.");if(n.multi)throw new x("There is a multi type in the implicit list of a schema. Multi tags can only be listed as explicit.")})),t.forEach((function(n){if(!(n instanceof S))throw new x("Specified list of YAML types (or a single Type object) contains a non-Type object.")}));var i=Object.create(T.prototype);return i.implicit=(this.implicit||[]).concat(e),i.explicit=(this.explicit||[]).concat(t),i.compiledImplicit=C(i,"implicit"),i.compiledExplicit=C(i,"explicit"),i.compiledTypeMap=function(){var n,e,t={scalar:{},sequence:{},mapping:{},fallback:{},multi:{scalar:[],sequence:[],mapping:[],fallback:[]}};function i(n){n.multi?(t.multi[n.kind].push(n),t.multi.fallback.push(n)):t[n.kind][n.tag]=t.fallback[n.tag]=n}for(n=0,e=arguments.length;n<e;n+=1)arguments[n].forEach(i);return t}(i.compiledImplicit,i.compiledExplicit),i};var A=T,L=new k("tag:yaml.org,2002:str",{kind:"scalar",construct:function(n){return null!==n?n:""}}),F=new k("tag:yaml.org,2002:seq",{kind:"sequence",construct:function(n){return null!==n?n:[]}}),M=new k("tag:yaml.org,2002:map",{kind:"mapping",construct:function(n){return null!==n?n:{}}}),E=new A({explicit:[L,F,M]});var D=new k("tag:yaml.org,2002:null",{kind:"scalar",resolve:function(n){if(null===n)return!0;var e=n.length;return 1===e&&"~"===n||4===e&&("null"===n||"Null"===n||"NULL"===n)},construct:function(){return null},predicate:function(n){return null===n},represent:{canonical:function(){return"~"},lowercase:function(){return"null"},uppercase:function(){return"NULL"},camelcase:function(){return"Null"},empty:function(){return""}},defaultStyle:"lowercase"});var N=new k("tag:yaml.org,2002:bool",{kind:"scalar",resolve:function(n){if(null===n)return!1;var e=n.length;return 4===e&&("true"===n||"True"===n||"TRUE"===n)||5===e&&("false"===n||"False"===n||"FALSE"===n)},construct:function(n){return"true"===n||"True"===n||"TRUE"===n},predicate:function(n){return"[object Boolean]"===Object.prototype.toString.call(n)},represent:{lowercase:function(n){return n?"true":"false"},uppercase:function(n){return n?"TRUE":"FALSE"},camelcase:function(n){return n?"True":"False"}},defaultStyle:"lowercase"}),O=c;function I(n){return 48<=n&&n<=55}function q(n){return 48<=n&&n<=57}var U=new k("tag:yaml.org,2002:int",{kind:"scalar",resolve:function(n){if(null===n)return!1;var e,t,i=n.length,a=0,r=!1;if(!i)return!1;if("-"!==(e=n[a])&&"+"!==e||(e=n[++a]),"0"===e){if(a+1===i)return!0;if("b"===(e=n[++a])){for(a++;a<i;a++)if("_"!==(e=n[a])){if("0"!==e&&"1"!==e)return!1;r=!0}return r&&"_"!==e}if("x"===e){for(a++;a<i;a++)if("_"!==(e=n[a])){if(!(48<=(t=n.charCodeAt(a))&&t<=57||65<=t&&t<=70||97<=t&&t<=102))return!1;r=!0}return r&&"_"!==e}if("o"===e){for(a++;a<i;a++)if("_"!==(e=n[a])){if(!I(n.charCodeAt(a)))return!1;r=!0}return r&&"_"!==e}}if("_"===e)return!1;for(;a<i;a++)if("_"!==(e=n[a])){if(!q(n.charCodeAt(a)))return!1;r=!0}return!(!r||"_"===e)},construct:function(n){var e,t=n,i=1;if(-1!==t.indexOf("_")&&(t=t.replace(/_/g,"")),"-"!==(e=t[0])&&"+"!==e||("-"===e&&(i=-1),e=(t=t.slice(1))[0]),"0"===t)return 0;if("0"===e){if("b"===t[1])return i*parseInt(t.slice(2),2);if("x"===t[1])return i*parseInt(t.slice(2),16);if("o"===t[1])return i*parseInt(t.slice(2),8)}return i*parseInt(t,10)},predicate:function(n){return"[object Number]"===Object.prototype.toString.call(n)&&n%1==0&&!O.isNegativeZero(n)},represent:{binary:function(n){return n>=0?"0b"+n.toString(2):"-0b"+n.toString(2).slice(1)},octal:function(n){return n>=0?"0o"+n.toString(8):"-0o"+n.toString(8).slice(1)},decimal:function(n){return n.toString(10)},hexadecimal:function(n){return n>=0?"0x"+n.toString(16).toUpperCase():"-0x"+n.toString(16).toUpperCase().slice(1)}},defaultStyle:"decimal",styleAliases:{binary:[2,"bin"],octal:[8,"oct"],decimal:[10,"dec"],hexadecimal:[16,"hex"]}}),j=c,B=k,P=new RegExp("^(?:[-+]?(?:[0-9][0-9_]*)(?:\\.[0-9_]*)?(?:[eE][-+]?[0-9]+)?|\\.[0-9_]+(?:[eE][-+]?[0-9]+)?|[-+]?\\.(?:inf|Inf|INF)|\\.(?:nan|NaN|NAN))$");var Y=/^[-+]?[0-9]+e/;var W=new B("tag:yaml.org,2002:float",{kind:"scalar",resolve:function(n){return null!==n&&!(!P.test(n)||"_"===n[n.length-1])},construct:function(n){var e,t;return t="-"===(e=n.replace(/_/g,"").toLowerCase())[0]?-1:1,"+-".indexOf(e[0])>=0&&(e=e.slice(1)),".inf"===e?1===t?Number.POSITIVE_INFINITY:Number.NEGATIVE_INFINITY:".nan"===e?NaN:t*parseFloat(e,10)},predicate:function(n){return"[object Number]"===Object.prototype.toString.call(n)&&(n%1!=0||j.isNegativeZero(n))},represent:function(n,e){var t;if(isNaN(n))switch(e){case"lowercase":return".nan";case"uppercase":return".NAN";case"camelcase":return".NaN"}else if(Number.POSITIVE_INFINITY===n)switch(e){case"lowercase":return".inf";case"uppercase":return".INF";case"camelcase":return".Inf"}else if(Number.NEGATIVE_INFINITY===n)switch(e){case"lowercase":return"-.inf";case"uppercase":return"-.INF";case"camelcase":return"-.Inf"}else if(j.isNegativeZero(n))return"-0.0";return t=n.toString(10),Y.test(t)?t.replace("e",".e"):t},defaultStyle:"lowercase"}),H=E.extend({implicit:[D,N,U,W]}),R=H,z=k,Q=new RegExp("^([0-9][0-9][0-9][0-9])-([0-9][0-9])-([0-9][0-9])$"),G=new RegExp("^([0-9][0-9][0-9][0-9])-([0-9][0-9]?)-([0-9][0-9]?)(?:[Tt]|[ \\t]+)([0-9][0-9]?):([0-9][0-9]):([0-9][0-9])(?:\\.([0-9]*))?(?:[ \\t]*(Z|([-+])([0-9][0-9]?)(?::([0-9][0-9]))?))?$");var V=new z("tag:yaml.org,2002:timestamp",{kind:"scalar",resolve:function(n){return null!==n&&(null!==Q.exec(n)||null!==G.exec(n))},construct:function(n){var e,t,i,a,r,l,o,s,u=0,c=null;if(null===(e=Q.exec(n))&&(e=G.exec(n)),null===e)throw new Error("Date resolve error");if(t=+e[1],i=+e[2]-1,a=+e[3],!e[4])return new Date(Date.UTC(t,i,a));if(r=+e[4],l=+e[5],o=+e[6],e[7]){for(u=e[7].slice(0,3);u.length<3;)u+="0";u=+u}return e[9]&&(c=6e4*(60*+e[10]+ +(e[11]||0)),"-"===e[9]&&(c=-c)),s=new Date(Date.UTC(t,i,a,r,l,o,u)),c&&s.setTime(s.getTime()-c),s},instanceOf:Date,represent:function(n){return n.toISOString()}});var X=new k("tag:yaml.org,2002:merge",{kind:"scalar",resolve:function(n){return"<<"===n||null===n}}),K="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=\n\r";var $=new k("tag:yaml.org,2002:binary",{kind:"scalar",resolve:function(n){if(null===n)return!1;var e,t,i=0,a=n.length,r=K;for(t=0;t<a;t++)if(!((e=r.indexOf(n.charAt(t)))>64)){if(e<0)return!1;i+=6}return i%8==0},construct:function(n){var e,t,i=n.replace(/[\r\n=]/g,""),a=i.length,r=K,l=0,o=[];for(e=0;e<a;e++)e%4==0&&e&&(o.push(l>>16&255),o.push(l>>8&255),o.push(255&l)),l=l<<6|r.indexOf(i.charAt(e));return 0===(t=a%4*6)?(o.push(l>>16&255),o.push(l>>8&255),o.push(255&l)):18===t?(o.push(l>>10&255),o.push(l>>2&255)):12===t&&o.push(l>>4&255),new Uint8Array(o)},predicate:function(n){return"[object Uint8Array]"===Object.prototype.toString.call(n)},represent:function(n){var e,t,i="",a=0,r=n.length,l=K;for(e=0;e<r;e++)e%3==0&&e&&(i+=l[a>>18&63],i+=l[a>>12&63],i+=l[a>>6&63],i+=l[63&a]),a=(a<<8)+n[e];return 0===(t=r%3)?(i+=l[a>>18&63],i+=l[a>>12&63],i+=l[a>>6&63],i+=l[63&a]):2===t?(i+=l[a>>10&63],i+=l[a>>4&63],i+=l[a<<2&63],i+=l[64]):1===t&&(i+=l[a>>2&63],i+=l[a<<4&63],i+=l[64],i+=l[64]),i}}),J=k,Z=Object.prototype.hasOwnProperty,nn=Object.prototype.toString;var en=new J("tag:yaml.org,2002:omap",{kind:"sequence",resolve:function(n){if(null===n)return!0;var e,t,i,a,r,l=[],o=n;for(e=0,t=o.length;e<t;e+=1){if(i=o[e],r=!1,"[object Object]"!==nn.call(i))return!1;for(a in i)if(Z.call(i,a)){if(r)return!1;r=!0}if(!r)return!1;if(-1!==l.indexOf(a))return!1;l.push(a)}return!0},construct:function(n){return null!==n?n:[]}}),tn=k,an=Object.prototype.toString;var rn=new tn("tag:yaml.org,2002:pairs",{kind:"sequence",resolve:function(n){if(null===n)return!0;var e,t,i,a,r,l=n;for(r=new Array(l.length),e=0,t=l.length;e<t;e+=1){if(i=l[e],"[object Object]"!==an.call(i))return!1;if(1!==(a=Object.keys(i)).length)return!1;r[e]=[a[0],i[a[0]]]}return!0},construct:function(n){if(null===n)return[];var e,t,i,a,r,l=n;for(r=new Array(l.length),e=0,t=l.length;e<t;e+=1)i=l[e],a=Object.keys(i),r[e]=[a[0],i[a[0]]];return r}}),ln=k,on=Object.prototype.hasOwnProperty;var sn=new ln("tag:yaml.org,2002:set",{kind:"mapping",resolve:function(n){if(null===n)return!0;var e,t=n;for(e in t)if(on.call(t,e)&&null!==t[e])return!1;return!0},construct:function(n){return null!==n?n:{}}}),un=R.extend({implicit:[V,X],explicit:[$,en,rn,sn]}),cn=c,dn=h,pn=y,fn=un,hn=Object.prototype.hasOwnProperty,gn=/[\x00-\x08\x0B\x0C\x0E-\x1F\x7F-\x84\x86-\x9F\uFFFE\uFFFF]|[\uD800-\uDBFF](?![\uDC00-\uDFFF])|(?:[^\uD800-\uDBFF]|^)[\uDC00-\uDFFF]/,mn=/[\x85\u2028\u2029]/,_n=/[,\[\]\{\}]/,yn=/^(?:!|!!|![a-z\-]+!)$/i,bn=/^(?:!|[^,\[\]\{\}])(?:%[0-9a-f]{2}|[0-9a-z\-#;\/\?:@&=\+\$,_\.!~\*'\(\)\[\]])*$/i;function vn(n){return Object.prototype.toString.call(n)}function wn(n){return 10===n||13===n}function kn(n){return 9===n||32===n}function xn(n){return 9===n||32===n||10===n||13===n}function Sn(n){return 44===n||91===n||93===n||123===n||125===n}function Cn(n){var e;return 48<=n&&n<=57?n-48:97<=(e=32|n)&&e<=102?e-97+10:-1}function Tn(n){return 48===n?"\0":97===n?"":98===n?"\b":116===n||9===n?"\t":110===n?"\n":118===n?"\v":102===n?"\f":114===n?"\r":101===n?"":32===n?" ":34===n?'"':47===n?"/":92===n?"\\":78===n?"Â…":95===n?"Â ":76===n?"\u2028":80===n?"\u2029":""}function An(n){return n<=65535?String.fromCharCode(n):String.fromCharCode(55296+(n-65536>>10),56320+(n-65536&1023))}for(var Ln=new Array(256),Fn=new Array(256),Mn=0;Mn<256;Mn++)Ln[Mn]=Tn(Mn)?1:0,Fn[Mn]=Tn(Mn);function En(n,e){this.input=n,this.filename=e.filename||null,this.schema=e.schema||fn,this.onWarning=e.onWarning||null,this.legacy=e.legacy||!1,this.json=e.json||!1,this.listener=e.listener||null,this.implicitTypes=this.schema.compiledImplicit,this.typeMap=this.schema.compiledTypeMap,this.length=n.length,this.position=0,this.line=0,this.lineStart=0,this.lineIndent=0,this.firstTabInLine=-1,this.documents=[]}function Dn(n,e){var t={name:n.filename,buffer:n.input.slice(0,-1),position:n.position,line:n.line,column:n.position-n.lineStart};return t.snippet=pn(t),new dn(e,t)}function Nn(n,e){throw Dn(n,e)}function On(n,e){n.onWarning&&n.onWarning.call(null,Dn(n,e))}var In={YAML:function(n,e,t){var i,a,r;null!==n.version&&Nn(n,"duplication of %YAML directive"),1!==t.length&&Nn(n,"YAML directive accepts exactly one argument"),null===(i=/^([0-9]+)\.([0-9]+)$/.exec(t[0]))&&Nn(n,"ill-formed argument of the YAML directive"),a=parseInt(i[1],10),r=parseInt(i[2],10),1!==a&&Nn(n,"unacceptable YAML version of the document"),n.version=t[0],n.checkLineBreaks=r<2,1!==r&&2!==r&&On(n,"unsupported YAML version of the document")},TAG:function(n,e,t){var i,a;2!==t.length&&Nn(n,"TAG directive accepts exactly two arguments"),i=t[0],a=t[1],yn.test(i)||Nn(n,"ill-formed tag handle (first argument) of the TAG directive"),hn.call(n.tagMap,i)&&Nn(n,'there is a previously declared suffix for "'+i+'" tag handle'),bn.test(a)||Nn(n,"ill-formed tag prefix (second argument) of the TAG directive");try{a=decodeURIComponent(a)}catch(e){Nn(n,"tag prefix is malformed: "+a)}n.tagMap[i]=a}};function qn(n,e,t,i){var a,r,l,o;if(e<t){if(o=n.input.slice(e,t),i)for(a=0,r=o.length;a<r;a+=1)9===(l=o.charCodeAt(a))||32<=l&&l<=1114111||Nn(n,"expected valid JSON character");else gn.test(o)&&Nn(n,"the stream contains non-printable characters");n.result+=o}}function Un(n,e,t,i){var a,r,l,o;for(cn.isObject(t)||Nn(n,"cannot merge mappings; the provided source object is unacceptable"),l=0,o=(a=Object.keys(t)).length;l<o;l+=1)r=a[l],hn.call(e,r)||(e[r]=t[r],i[r]=!0)}function jn(n,e,t,i,a,r,l,o,s){var u,c;if(Array.isArray(a))for(u=0,c=(a=Array.prototype.slice.call(a)).length;u<c;u+=1)Array.isArray(a[u])&&Nn(n,"nested arrays are not supported inside keys"),"object"==typeof a&&"[object Object]"===vn(a[u])&&(a[u]="[object Object]");if("object"==typeof a&&"[object Object]"===vn(a)&&(a="[object Object]"),a=String(a),null===e&&(e={}),"tag:yaml.org,2002:merge"===i)if(Array.isArray(r))for(u=0,c=r.length;u<c;u+=1)Un(n,e,r[u],t);else Un(n,e,r,t);else n.json||hn.call(t,a)||!hn.call(e,a)||(n.line=l||n.line,n.lineStart=o||n.lineStart,n.position=s||n.position,Nn(n,"duplicated mapping key")),"__proto__"===a?Object.defineProperty(e,a,{configurable:!0,enumerable:!0,writable:!0,value:r}):e[a]=r,delete t[a];return e}function Bn(n){var e;10===(e=n.input.charCodeAt(n.position))?n.position++:13===e?(n.position++,10===n.input.charCodeAt(n.position)&&n.position++):Nn(n,"a line break is expected"),n.line+=1,n.lineStart=n.position,n.firstTabInLine=-1}function Pn(n,e,t){for(var i=0,a=n.input.charCodeAt(n.position);0!==a;){for(;kn(a);)9===a&&-1===n.firstTabInLine&&(n.firstTabInLine=n.position),a=n.input.charCodeAt(++n.position);if(e&&35===a)do{a=n.input.charCodeAt(++n.position)}while(10!==a&&13!==a&&0!==a);if(!wn(a))break;for(Bn(n),a=n.input.charCodeAt(n.position),i++,n.lineIndent=0;32===a;)n.lineIndent++,a=n.input.charCodeAt(++n.position)}return-1!==t&&0!==i&&n.lineIndent<t&&On(n,"deficient indentation"),i}function Yn(n){var e,t=n.position;return!(45!==(e=n.input.charCodeAt(t))&&46!==e||e!==n.input.charCodeAt(t+1)||e!==n.input.charCodeAt(t+2)||(t+=3,0!==(e=n.input.charCodeAt(t))&&!xn(e)))}function Wn(n,e){1===e?n.result+=" ":e>1&&(n.result+=cn.repeat("\n",e-1))}function Hn(n,e){var t,i,a=n.tag,r=n.anchor,l=[],o=!1;if(-1!==n.firstTabInLine)return!1;for(null!==n.anchor&&(n.anchorMap[n.anchor]=l),i=n.input.charCodeAt(n.position);0!==i&&(-1!==n.firstTabInLine&&(n.position=n.firstTabInLine,Nn(n,"tab characters must not be used in indentation")),45===i)&&xn(n.input.charCodeAt(n.position+1));)if(o=!0,n.position++,Pn(n,!0,-1)&&n.lineIndent<=e)l.push(null),i=n.input.charCodeAt(n.position);else if(t=n.line,Qn(n,e,3,!1,!0),l.push(n.result),Pn(n,!0,-1),i=n.input.charCodeAt(n.position),(n.line===t||n.lineIndent>e)&&0!==i)Nn(n,"bad indentation of a sequence entry");else if(n.lineIndent<e)break;return!!o&&(n.tag=a,n.anchor=r,n.kind="sequence",n.result=l,!0)}function Rn(n){var e,t,i,a,r=!1,l=!1;if(33!==(a=n.input.charCodeAt(n.position)))return!1;if(null!==n.tag&&Nn(n,"duplication of a tag property"),60===(a=n.input.charCodeAt(++n.position))?(r=!0,a=n.input.charCodeAt(++n.position)):33===a?(l=!0,t="!!",a=n.input.charCodeAt(++n.position)):t="!",e=n.position,r){do{a=n.input.charCodeAt(++n.position)}while(0!==a&&62!==a);n.position<n.length?(i=n.input.slice(e,n.position),a=n.input.charCodeAt(++n.position)):Nn(n,"unexpected end of the stream within a verbatim tag")}else{for(;0!==a&&!xn(a);)33===a&&(l?Nn(n,"tag suffix cannot contain exclamation marks"):(t=n.input.slice(e-1,n.position+1),yn.test(t)||Nn(n,"named tag handle cannot contain such characters"),l=!0,e=n.position+1)),a=n.input.charCodeAt(++n.position);i=n.input.slice(e,n.position),_n.test(i)&&Nn(n,"tag suffix cannot contain flow indicator characters")}i&&!bn.test(i)&&Nn(n,"tag name cannot contain such characters: "+i);try{i=decodeURIComponent(i)}catch(e){Nn(n,"tag name is malformed: "+i)}return r?n.tag=i:hn.call(n.tagMap,t)?n.tag=n.tagMap[t]+i:"!"===t?n.tag="!"+i:"!!"===t?n.tag="tag:yaml.org,2002:"+i:Nn(n,'undeclared tag handle "'+t+'"'),!0}function zn(n){var e,t;if(38!==(t=n.input.charCodeAt(n.position)))return!1;for(null!==n.anchor&&Nn(n,"duplication of an anchor property"),t=n.input.charCodeAt(++n.position),e=n.position;0!==t&&!xn(t)&&!Sn(t);)t=n.input.charCodeAt(++n.position);return n.position===e&&Nn(n,"name of an anchor node must contain at least one character"),n.anchor=n.input.slice(e,n.position),!0}function Qn(n,e,t,i,a){var r,l,o,s,u,c,d,p,f,h=1,g=!1,m=!1;if(null!==n.listener&&n.listener("open",n),n.tag=null,n.anchor=null,n.kind=null,n.result=null,r=l=o=4===t||3===t,i&&Pn(n,!0,-1)&&(g=!0,n.lineIndent>e?h=1:n.lineIndent===e?h=0:n.lineIndent<e&&(h=-1)),1===h)for(;Rn(n)||zn(n);)Pn(n,!0,-1)?(g=!0,o=r,n.lineIndent>e?h=1:n.lineIndent===e?h=0:n.lineIndent<e&&(h=-1)):o=!1;if(o&&(o=g||a),1!==h&&4!==t||(p=1===t||2===t?e:e+1,f=n.position-n.lineStart,1===h?o&&(Hn(n,f)||function(n,e,t){var i,a,r,l,o,s,u,c=n.tag,d=n.anchor,p={},f=Object.create(null),h=null,g=null,m=null,_=!1,y=!1;if(-1!==n.firstTabInLine)return!1;for(null!==n.anchor&&(n.anchorMap[n.anchor]=p),u=n.input.charCodeAt(n.position);0!==u;){if(_||-1===n.firstTabInLine||(n.position=n.firstTabInLine,Nn(n,"tab characters must not be used in indentation")),i=n.input.charCodeAt(n.position+1),r=n.line,63!==u&&58!==u||!xn(i)){if(l=n.line,o=n.lineStart,s=n.position,!Qn(n,t,2,!1,!0))break;if(n.line===r){for(u=n.input.charCodeAt(n.position);kn(u);)u=n.input.charCodeAt(++n.position);if(58===u)xn(u=n.input.charCodeAt(++n.position))||Nn(n,"a whitespace character is expected after the key-value separator within a block mapping"),_&&(jn(n,p,f,h,g,null,l,o,s),h=g=m=null),y=!0,_=!1,a=!1,h=n.tag,g=n.result;else{if(!y)return n.tag=c,n.anchor=d,!0;Nn(n,"can not read an implicit mapping pair; a colon is missed")}}else{if(!y)return n.tag=c,n.anchor=d,!0;Nn(n,"can not read a block mapping entry; a multiline key may not be an implicit key")}}else 63===u?(_&&(jn(n,p,f,h,g,null,l,o,s),h=g=m=null),y=!0,_=!0,a=!0):_?(_=!1,a=!0):Nn(n,"incomplete explicit mapping pair; a key node is missed; or followed by a non-tabulated empty line"),n.position+=1,u=i;if((n.line===r||n.lineIndent>e)&&(_&&(l=n.line,o=n.lineStart,s=n.position),Qn(n,e,4,!0,a)&&(_?g=n.result:m=n.result),_||(jn(n,p,f,h,g,m,l,o,s),h=g=m=null),Pn(n,!0,-1),u=n.input.charCodeAt(n.position)),(n.line===r||n.lineIndent>e)&&0!==u)Nn(n,"bad indentation of a mapping entry");else if(n.lineIndent<e)break}return _&&jn(n,p,f,h,g,null,l,o,s),y&&(n.tag=c,n.anchor=d,n.kind="mapping",n.result=p),y}(n,f,p))||function(n,e){var t,i,a,r,l,o,s,u,c,d,p,f,h=!0,g=n.tag,m=n.anchor,_=Object.create(null);if(91===(f=n.input.charCodeAt(n.position)))l=93,u=!1,r=[];else{if(123!==f)return!1;l=125,u=!0,r={}}for(null!==n.anchor&&(n.anchorMap[n.anchor]=r),f=n.input.charCodeAt(++n.position);0!==f;){if(Pn(n,!0,e),(f=n.input.charCodeAt(n.position))===l)return n.position++,n.tag=g,n.anchor=m,n.kind=u?"mapping":"sequence",n.result=r,!0;h?44===f&&Nn(n,"expected the node content, but found ','"):Nn(n,"missed comma between flow collection entries"),p=null,o=s=!1,63===f&&xn(n.input.charCodeAt(n.position+1))&&(o=s=!0,n.position++,Pn(n,!0,e)),t=n.line,i=n.lineStart,a=n.position,Qn(n,e,1,!1,!0),d=n.tag,c=n.result,Pn(n,!0,e),f=n.input.charCodeAt(n.position),!s&&n.line!==t||58!==f||(o=!0,f=n.input.charCodeAt(++n.position),Pn(n,!0,e),Qn(n,e,1,!1,!0),p=n.result),u?jn(n,r,_,d,c,p,t,i,a):o?r.push(jn(n,null,_,d,c,p,t,i,a)):r.push(c),Pn(n,!0,e),44===(f=n.input.charCodeAt(n.position))?(h=!0,f=n.input.charCodeAt(++n.position)):h=!1}Nn(n,"unexpected end of the stream within a flow collection")}(n,p)?m=!0:(l&&function(n,e){var t,i,a,r,l,o=1,s=!1,u=!1,c=e,d=0,p=!1;if(124===(r=n.input.charCodeAt(n.position)))i=!1;else{if(62!==r)return!1;i=!0}for(n.kind="scalar",n.result="";0!==r;)if(43===(r=n.input.charCodeAt(++n.position))||45===r)1===o?o=43===r?3:2:Nn(n,"repeat of a chomping mode identifier");else{if(!((a=48<=(l=r)&&l<=57?l-48:-1)>=0))break;0===a?Nn(n,"bad explicit indentation width of a block scalar; it cannot be less than one"):u?Nn(n,"repeat of an indentation width identifier"):(c=e+a-1,u=!0)}if(kn(r)){do{r=n.input.charCodeAt(++n.position)}while(kn(r));if(35===r)do{r=n.input.charCodeAt(++n.position)}while(!wn(r)&&0!==r)}for(;0!==r;){for(Bn(n),n.lineIndent=0,r=n.input.charCodeAt(n.position);(!u||n.lineIndent<c)&&32===r;)n.lineIndent++,r=n.input.charCodeAt(++n.position);if(!u&&n.lineIndent>c&&(c=n.lineIndent),wn(r))d++;else{if(n.lineIndent<c){3===o?n.result+=cn.repeat("\n",s?1+d:d):1===o&&s&&(n.result+="\n");break}for(i?kn(r)?(p=!0,n.result+=cn.repeat("\n",s?1+d:d)):p?(p=!1,n.result+=cn.repeat("\n",d+1)):0===d?s&&(n.result+=" "):n.result+=cn.repeat("\n",d):n.result+=cn.repeat("\n",s?1+d:d),s=!0,u=!0,d=0,t=n.position;!wn(r)&&0!==r;)r=n.input.charCodeAt(++n.position);qn(n,t,n.position,!1)}}return!0}(n,p)||function(n,e){var t,i,a;if(39!==(t=n.input.charCodeAt(n.position)))return!1;for(n.kind="scalar",n.result="",n.position++,i=a=n.position;0!==(t=n.input.charCodeAt(n.position));)if(39===t){if(qn(n,i,n.position,!0),39!==(t=n.input.charCodeAt(++n.position)))return!0;i=n.position,n.position++,a=n.position}else wn(t)?(qn(n,i,a,!0),Wn(n,Pn(n,!1,e)),i=a=n.position):n.position===n.lineStart&&Yn(n)?Nn(n,"unexpected end of the document within a single quoted scalar"):(n.position++,a=n.position);Nn(n,"unexpected end of the stream within a single quoted scalar")}(n,p)||function(n,e){var t,i,a,r,l,o,s;if(34!==(o=n.input.charCodeAt(n.position)))return!1;for(n.kind="scalar",n.result="",n.position++,t=i=n.position;0!==(o=n.input.charCodeAt(n.position));){if(34===o)return qn(n,t,n.position,!0),n.position++,!0;if(92===o){if(qn(n,t,n.position,!0),wn(o=n.input.charCodeAt(++n.position)))Pn(n,!1,e);else if(o<256&&Ln[o])n.result+=Fn[o],n.position++;else if((l=120===(s=o)?2:117===s?4:85===s?8:0)>0){for(a=l,r=0;a>0;a--)(l=Cn(o=n.input.charCodeAt(++n.position)))>=0?r=(r<<4)+l:Nn(n,"expected hexadecimal character");n.result+=An(r),n.position++}else Nn(n,"unknown escape sequence");t=i=n.position}else wn(o)?(qn(n,t,i,!0),Wn(n,Pn(n,!1,e)),t=i=n.position):n.position===n.lineStart&&Yn(n)?Nn(n,"unexpected end of the document within a double quoted scalar"):(n.position++,i=n.position)}Nn(n,"unexpected end of the stream within a double quoted scalar")}(n,p)?m=!0:!function(n){var e,t,i;if(42!==(i=n.input.charCodeAt(n.position)))return!1;for(i=n.input.charCodeAt(++n.position),e=n.position;0!==i&&!xn(i)&&!Sn(i);)i=n.input.charCodeAt(++n.position);return n.position===e&&Nn(n,"name of an alias node must contain at least one character"),t=n.input.slice(e,n.position),hn.call(n.anchorMap,t)||Nn(n,'unidentified alias "'+t+'"'),n.result=n.anchorMap[t],Pn(n,!0,-1),!0}(n)?function(n,e,t){var i,a,r,l,o,s,u,c,d=n.kind,p=n.result;if(xn(c=n.input.charCodeAt(n.position))||Sn(c)||35===c||38===c||42===c||33===c||124===c||62===c||39===c||34===c||37===c||64===c||96===c)return!1;if((63===c||45===c)&&(xn(i=n.input.charCodeAt(n.position+1))||t&&Sn(i)))return!1;for(n.kind="scalar",n.result="",a=r=n.position,l=!1;0!==c;){if(58===c){if(xn(i=n.input.charCodeAt(n.position+1))||t&&Sn(i))break}else if(35===c){if(xn(n.input.charCodeAt(n.position-1)))break}else{if(n.position===n.lineStart&&Yn(n)||t&&Sn(c))break;if(wn(c)){if(o=n.line,s=n.lineStart,u=n.lineIndent,Pn(n,!1,-1),n.lineIndent>=e){l=!0,c=n.input.charCodeAt(n.position);continue}n.position=r,n.line=o,n.lineStart=s,n.lineIndent=u;break}}l&&(qn(n,a,r,!1),Wn(n,n.line-o),a=r=n.position,l=!1),kn(c)||(r=n.position+1),c=n.input.charCodeAt(++n.position)}return qn(n,a,r,!1),!!n.result||(n.kind=d,n.result=p,!1)}(n,p,1===t)&&(m=!0,null===n.tag&&(n.tag="?")):(m=!0,null===n.tag&&null===n.anchor||Nn(n,"alias node should not have any properties")),null!==n.anchor&&(n.anchorMap[n.anchor]=n.result)):0===h&&(m=o&&Hn(n,f))),null===n.tag)null!==n.anchor&&(n.anchorMap[n.anchor]=n.result);else if("?"===n.tag){for(null!==n.result&&"scalar"!==n.kind&&Nn(n,'unacceptable node kind for !<?> tag; it should be "scalar", not "'+n.kind+'"'),s=0,u=n.implicitTypes.length;s<u;s+=1)if((d=n.implicitTypes[s]).resolve(n.result)){n.result=d.construct(n.result),n.tag=d.tag,null!==n.anchor&&(n.anchorMap[n.anchor]=n.result);break}}else if("!"!==n.tag){if(hn.call(n.typeMap[n.kind||"fallback"],n.tag))d=n.typeMap[n.kind||"fallback"][n.tag];else for(d=null,s=0,u=(c=n.typeMap.multi[n.kind||"fallback"]).length;s<u;s+=1)if(n.tag.slice(0,c[s].tag.length)===c[s].tag){d=c[s];break}d||Nn(n,"unknown tag !<"+n.tag+">"),null!==n.result&&d.kind!==n.kind&&Nn(n,"unacceptable node kind for !<"+n.tag+'> tag; it should be "'+d.kind+'", not "'+n.kind+'"'),d.resolve(n.result,n.tag)?(n.result=d.construct(n.result,n.tag),null!==n.anchor&&(n.anchorMap[n.anchor]=n.result)):Nn(n,"cannot resolve a node with !<"+n.tag+"> explicit tag")}return null!==n.listener&&n.listener("close",n),null!==n.tag||null!==n.anchor||m}function Gn(n){var e,t,i,a,r=n.position,l=!1;for(n.version=null,n.checkLineBreaks=n.legacy,n.tagMap=Object.create(null),n.anchorMap=Object.create(null);0!==(a=n.input.charCodeAt(n.position))&&(Pn(n,!0,-1),a=n.input.charCodeAt(n.position),!(n.lineIndent>0||37!==a));){for(l=!0,a=n.input.charCodeAt(++n.position),e=n.position;0!==a&&!xn(a);)a=n.input.charCodeAt(++n.position);for(i=[],(t=n.input.slice(e,n.position)).length<1&&Nn(n,"directive name must not be less than one character in length");0!==a;){for(;kn(a);)a=n.input.charCodeAt(++n.position);if(35===a){do{a=n.input.charCodeAt(++n.position)}while(0!==a&&!wn(a));break}if(wn(a))break;for(e=n.position;0!==a&&!xn(a);)a=n.input.charCodeAt(++n.position);i.push(n.input.slice(e,n.position))}0!==a&&Bn(n),hn.call(In,t)?In[t](n,t,i):On(n,'unknown document directive "'+t+'"')}Pn(n,!0,-1),0===n.lineIndent&&45===n.input.charCodeAt(n.position)&&45===n.input.charCodeAt(n.position+1)&&45===n.input.charCodeAt(n.position+2)?(n.position+=3,Pn(n,!0,-1)):l&&Nn(n,"directives end mark is expected"),Qn(n,n.lineIndent-1,4,!1,!0),Pn(n,!0,-1),n.checkLineBreaks&&mn.test(n.input.slice(r,n.position))&&On(n,"non-ASCII line breaks are interpreted as content"),n.documents.push(n.result),n.position===n.lineStart&&Yn(n)?46===n.input.charCodeAt(n.position)&&(n.position+=3,Pn(n,!0,-1)):n.position<n.length-1&&Nn(n,"end of the stream or a document separator is expected")}function Vn(n,e){e=e||{},0!==(n=String(n)).length&&(10!==n.charCodeAt(n.length-1)&&13!==n.charCodeAt(n.length-1)&&(n+="\n"),65279===n.charCodeAt(0)&&(n=n.slice(1)));var t=new En(n,e),i=n.indexOf("\0");for(-1!==i&&(t.position=i,Nn(t,"null byte is not allowed in input")),t.input+="\0";32===t.input.charCodeAt(t.position);)t.lineIndent+=1,t.position+=1;for(;t.position<t.length-1;)Gn(t);return t.documents}u.loadAll=function(n,e,t){null!==e&&"object"==typeof e&&void 0===t&&(t=e,e=null);var i=Vn(n,t);if("function"!=typeof e)return i;for(var a=0,r=i.length;a<r;a+=1)e(i[a])},u.load=function(n,e){var t=Vn(n,e);if(0!==t.length){if(1===t.length)return t[0];throw new dn("expected a single document in the stream, but found more")}};var Xn={},Kn=c,$n=h,Jn=un,Zn=Object.prototype.toString,ne=Object.prototype.hasOwnProperty,ee={0:"\\0",7:"\\a",8:"\\b",9:"\\t",10:"\\n",11:"\\v",12:"\\f",13:"\\r",27:"\\e",34:'\\"',92:"\\\\",133:"\\N",160:"\\_",8232:"\\L",8233:"\\P"},te=["y","Y","yes","Yes","YES","on","On","ON","n","N","no","No","NO","off","Off","OFF"],ie=/^[-+]?[0-9_]+(?::[0-9_]+)+(?:\.[0-9_]*)?$/;function ae(n){var e,t,i;if(e=n.toString(16).toUpperCase(),n<=255)t="x",i=2;else if(n<=65535)t="u",i=4;else{if(!(n<=4294967295))throw new $n("code point within a string may not be greater than 0xFFFFFFFF");t="U",i=8}return"\\"+t+Kn.repeat("0",i-e.length)+e}function re(n){this.schema=n.schema||Jn,this.indent=Math.max(1,n.indent||2),this.noArrayIndent=n.noArrayIndent||!1,this.skipInvalid=n.skipInvalid||!1,this.flowLevel=Kn.isNothing(n.flowLevel)?-1:n.flowLevel,this.styleMap=function(n,e){var t,i,a,r,l,o,s;if(null===e)return{};for(t={},a=0,r=(i=Object.keys(e)).length;a<r;a+=1)l=i[a],o=String(e[l]),"!!"===l.slice(0,2)&&(l="tag:yaml.org,2002:"+l.slice(2)),(s=n.compiledTypeMap.fallback[l])&&ne.call(s.styleAliases,o)&&(o=s.styleAliases[o]),t[l]=o;return t}(this.schema,n.styles||null),this.sortKeys=n.sortKeys||!1,this.lineWidth=n.lineWidth||80,this.noRefs=n.noRefs||!1,this.noCompatMode=n.noCompatMode||!1,this.condenseFlow=n.condenseFlow||!1,this.quotingType='"'===n.quotingType?2:1,this.forceQuotes=n.forceQuotes||!1,this.replacer="function"==typeof n.replacer?n.replacer:null,this.implicitTypes=this.schema.compiledImplicit,this.explicitTypes=this.schema.compiledExplicit,this.tag=null,this.result="",this.duplicates=[],this.usedDuplicates=null}function le(n,e){for(var t,i=Kn.repeat(" ",e),a=0,r=-1,l="",o=n.length;a<o;)-1===(r=n.indexOf("\n",a))?(t=n.slice(a),a=o):(t=n.slice(a,r+1),a=r+1),t.length&&"\n"!==t&&(l+=i),l+=t;return l}function oe(n,e){return"\n"+Kn.repeat(" ",n.indent*e)}function se(n){return 32===n||9===n}function ue(n){return 32<=n&&n<=126||161<=n&&n<=55295&&8232!==n&&8233!==n||57344<=n&&n<=65533&&65279!==n||65536<=n&&n<=1114111}function ce(n){return ue(n)&&65279!==n&&13!==n&&10!==n}function de(n,e,t){var i=ce(n),a=i&&!se(n);return(t?i:i&&44!==n&&91!==n&&93!==n&&123!==n&&125!==n)&&35!==n&&!(58===e&&!a)||ce(e)&&!se(e)&&35===n||58===e&&a}function pe(n,e){var t,i=n.charCodeAt(e);return i>=55296&&i<=56319&&e+1<n.length&&(t=n.charCodeAt(e+1))>=56320&&t<=57343?1024*(i-55296)+t-56320+65536:i}function fe(n){return/^\n* /.test(n)}function he(n,e,t,i,a,r,l,o){var s,u,c=0,d=null,p=!1,f=!1,h=-1!==i,g=-1,m=ue(u=pe(n,0))&&65279!==u&&!se(u)&&45!==u&&63!==u&&58!==u&&44!==u&&91!==u&&93!==u&&123!==u&&125!==u&&35!==u&&38!==u&&42!==u&&33!==u&&124!==u&&61!==u&&62!==u&&39!==u&&34!==u&&37!==u&&64!==u&&96!==u&&function(n){return!se(n)&&58!==n}(pe(n,n.length-1));if(e||l)for(s=0;s<n.length;c>=65536?s+=2:s++){if(!ue(c=pe(n,s)))return 5;m=m&&de(c,d,o),d=c}else{for(s=0;s<n.length;c>=65536?s+=2:s++){if(10===(c=pe(n,s)))p=!0,h&&(f=f||s-g-1>i&&" "!==n[g+1],g=s);else if(!ue(c))return 5;m=m&&de(c,d,o),d=c}f=f||h&&s-g-1>i&&" "!==n[g+1]}return p||f?t>9&&fe(n)?5:l?2===r?5:2:f?4:3:!m||l||a(n)?2===r?5:2:1}function ge(n,e,t,i,a){n.dump=function(){if(0===e.length)return 2===n.quotingType?'""':"''";if(!n.noCompatMode&&(-1!==te.indexOf(e)||ie.test(e)))return 2===n.quotingType?'"'+e+'"':"'"+e+"'";var r=n.indent*Math.max(1,t),l=-1===n.lineWidth?-1:Math.max(Math.min(n.lineWidth,40),n.lineWidth-r),o=i||n.flowLevel>-1&&t>=n.flowLevel;switch(he(e,o,n.indent,l,(function(e){return function(n,e){var t,i;for(t=0,i=n.implicitTypes.length;t<i;t+=1)if(n.implicitTypes[t].resolve(e))return!0;return!1}(n,e)}),n.quotingType,n.forceQuotes&&!i,a)){case 1:return e;case 2:return"'"+e.replace(/'/g,"''")+"'";case 3:return"|"+me(e,n.indent)+_e(le(e,r));case 4:return">"+me(e,n.indent)+_e(le(function(n,e){var t,i,a=/(\n+)([^\n]*)/g,r=(o=n.indexOf("\n"),o=-1!==o?o:n.length,a.lastIndex=o,ye(n.slice(0,o),e)),l="\n"===n[0]||" "===n[0];var o;for(;i=a.exec(n);){var s=i[1],u=i[2];t=" "===u[0],r+=s+(l||t||""===u?"":"\n")+ye(u,e),l=t}return r}(e,l),r));case 5:return'"'+function(n){for(var e,t="",i=0,a=0;a<n.length;i>=65536?a+=2:a++)i=pe(n,a),!(e=ee[i])&&ue(i)?(t+=n[a],i>=65536&&(t+=n[a+1])):t+=e||ae(i);return t}(e)+'"';default:throw new $n("impossible error: invalid scalar style")}}()}function me(n,e){var t=fe(n)?String(e):"",i="\n"===n[n.length-1];return t+(i&&("\n"===n[n.length-2]||"\n"===n)?"+":i?"":"-")+"\n"}function _e(n){return"\n"===n[n.length-1]?n.slice(0,-1):n}function ye(n,e){if(""===n||" "===n[0])return n;for(var t,i,a=/ [^ ]/g,r=0,l=0,o=0,s="";t=a.exec(n);)(o=t.index)-r>e&&(i=l>r?l:o,s+="\n"+n.slice(r,i),r=i+1),l=o;return s+="\n",n.length-r>e&&l>r?s+=n.slice(r,l)+"\n"+n.slice(l+1):s+=n.slice(r),s.slice(1)}function be(n,e,t,i){var a,r,l,o="",s=n.tag;for(a=0,r=t.length;a<r;a+=1)l=t[a],n.replacer&&(l=n.replacer.call(t,String(a),l)),(we(n,e+1,l,!0,!0,!1,!0)||void 0===l&&we(n,e+1,null,!0,!0,!1,!0))&&(i&&""===o||(o+=oe(n,e)),n.dump&&10===n.dump.charCodeAt(0)?o+="-":o+="- ",o+=n.dump);n.tag=s,n.dump=o||"[]"}function ve(n,e,t){var i,a,r,l,o,s;for(r=0,l=(a=t?n.explicitTypes:n.implicitTypes).length;r<l;r+=1)if(((o=a[r]).instanceOf||o.predicate)&&(!o.instanceOf||"object"==typeof e&&e instanceof o.instanceOf)&&(!o.predicate||o.predicate(e))){if(t?o.multi&&o.representName?n.tag=o.representName(e):n.tag=o.tag:n.tag="?",o.represent){if(s=n.styleMap[o.tag]||o.defaultStyle,"[object Function]"===Zn.call(o.represent))i=o.represent(e,s);else{if(!ne.call(o.represent,s))throw new $n("!<"+o.tag+'> tag resolver accepts not "'+s+'" style');i=o.represent[s](e,s)}n.dump=i}return!0}return!1}function we(n,e,t,i,a,r,l){n.tag=null,n.dump=t,ve(n,t,!1)||ve(n,t,!0);var o,s=Zn.call(n.dump),u=i;i&&(i=n.flowLevel<0||n.flowLevel>e);var c,d,p="[object Object]"===s||"[object Array]"===s;if(p&&(d=-1!==(c=n.duplicates.indexOf(t))),(null!==n.tag&&"?"!==n.tag||d||2!==n.indent&&e>0)&&(a=!1),d&&n.usedDuplicates[c])n.dump="*ref_"+c;else{if(p&&d&&!n.usedDuplicates[c]&&(n.usedDuplicates[c]=!0),"[object Object]"===s)i&&0!==Object.keys(n.dump).length?(!function(n,e,t,i){var a,r,l,o,s,u,c="",d=n.tag,p=Object.keys(t);if(!0===n.sortKeys)p.sort();else if("function"==typeof n.sortKeys)p.sort(n.sortKeys);else if(n.sortKeys)throw new $n("sortKeys must be a boolean or a function");for(a=0,r=p.length;a<r;a+=1)u="",i&&""===c||(u+=oe(n,e)),o=t[l=p[a]],n.replacer&&(o=n.replacer.call(t,l,o)),we(n,e+1,l,!0,!0,!0)&&((s=null!==n.tag&&"?"!==n.tag||n.dump&&n.dump.length>1024)&&(n.dump&&10===n.dump.charCodeAt(0)?u+="?":u+="? "),u+=n.dump,s&&(u+=oe(n,e)),we(n,e+1,o,!0,s)&&(n.dump&&10===n.dump.charCodeAt(0)?u+=":":u+=": ",c+=u+=n.dump));n.tag=d,n.dump=c||"{}"}(n,e,n.dump,a),d&&(n.dump="&ref_"+c+n.dump)):(!function(n,e,t){var i,a,r,l,o,s="",u=n.tag,c=Object.keys(t);for(i=0,a=c.length;i<a;i+=1)o="",""!==s&&(o+=", "),n.condenseFlow&&(o+='"'),l=t[r=c[i]],n.replacer&&(l=n.replacer.call(t,r,l)),we(n,e,r,!1,!1)&&(n.dump.length>1024&&(o+="? "),o+=n.dump+(n.condenseFlow?'"':"")+":"+(n.condenseFlow?"":" "),we(n,e,l,!1,!1)&&(s+=o+=n.dump));n.tag=u,n.dump="{"+s+"}"}(n,e,n.dump),d&&(n.dump="&ref_"+c+" "+n.dump));else if("[object Array]"===s)i&&0!==n.dump.length?(n.noArrayIndent&&!l&&e>0?be(n,e-1,n.dump,a):be(n,e,n.dump,a),d&&(n.dump="&ref_"+c+n.dump)):(!function(n,e,t){var i,a,r,l="",o=n.tag;for(i=0,a=t.length;i<a;i+=1)r=t[i],n.replacer&&(r=n.replacer.call(t,String(i),r)),(we(n,e,r,!1,!1)||void 0===r&&we(n,e,null,!1,!1))&&(""!==l&&(l+=","+(n.condenseFlow?"":" ")),l+=n.dump);n.tag=o,n.dump="["+l+"]"}(n,e,n.dump),d&&(n.dump="&ref_"+c+" "+n.dump));else{if("[object String]"!==s){if("[object Undefined]"===s)return!1;if(n.skipInvalid)return!1;throw new $n("unacceptable kind of an object to dump "+s)}"?"!==n.tag&&ge(n,n.dump,e,r,u)}null!==n.tag&&"?"!==n.tag&&(o=encodeURI("!"===n.tag[0]?n.tag.slice(1):n.tag).replace(/!/g,"%21"),o="!"===n.tag[0]?"!"+o:"tag:yaml.org,2002:"===o.slice(0,18)?"!!"+o.slice(18):"!<"+o+">",n.dump=o+" "+n.dump)}return!0}function ke(n,e){var t,i,a=[],r=[];for(xe(n,a,r),t=0,i=r.length;t<i;t+=1)e.duplicates.push(a[r[t]]);e.usedDuplicates=new Array(i)}function xe(n,e,t){var i,a,r;if(null!==n&&"object"==typeof n)if(-1!==(a=e.indexOf(n)))-1===t.indexOf(a)&&t.push(a);else if(e.push(n),Array.isArray(n))for(a=0,r=n.length;a<r;a+=1)xe(n[a],e,t);else for(a=0,r=(i=Object.keys(n)).length;a<r;a+=1)xe(n[i[a]],e,t)}Xn.dump=function(n,e){var t=new re(e=e||{});t.noRefs||ke(n,t);var i=n;return t.replacer&&(i=t.replacer.call({"":i},"",i)),we(t,0,i,!0,!0)?t.dump+"\n":""};var Se=u,Ce=Xn;function Te(n,e){return function(){throw new Error("Function yaml."+n+" is removed in js-yaml 4. Use yaml."+e+" instead, which is now safe by default.")}}s.Type=k,s.Schema=A,s.FAILSAFE_SCHEMA=E,s.JSON_SCHEMA=H,s.CORE_SCHEMA=R,s.DEFAULT_SCHEMA=un,s.load=Se.load,s.loadAll=Se.loadAll,s.dump=Ce.dump,s.YAMLException=h,s.types={binary:$,float:W,map:M,null:D,pairs:rn,set:sn,timestamp:V,bool:N,int:U,merge:X,omap:en,seq:F,str:L},s.safeLoad=Te("safeLoad","load"),s.safeLoadAll=Te("safeLoadAll","loadAll"),s.safeDump=Te("safeDump","dump");const Ae=i.default,Le=a.default;function Fe(n,e){if(e.length<n)throw new TypeError(n+" argument"+(n>1?"s":"")+" required, but only "+e.length+" present")}function Me(n){return Fe(1,arguments),n instanceof Date||"object"==typeof n&&"[object Date]"===Object.prototype.toString.call(n)}function Ee(n){Fe(1,arguments);var e=Object.prototype.toString.call(n);return n instanceof Date||"object"==typeof n&&"[object Date]"===e?new Date(n.getTime()):"number"==typeof n||"[object Number]"===e?new Date(n):("string"!=typeof n&&"[object String]"!==e||"undefined"==typeof console||(console.warn("Starting with v2.0.0-beta.1 date-fns doesn't accept strings as date arguments. Please use `parseISO` to parse strings. See: https://git.io/fjule"),console.warn((new Error).stack)),new Date(NaN))}function De(n){if(Fe(1,arguments),!Me(n)&&"number"!=typeof n)return!1;var e=Ee(n);return!isNaN(Number(e))}var Ne={lessThanXSeconds:{one:"less than a second",other:"less than {{count}} seconds"},xSeconds:{one:"1 second",other:"{{count}} seconds"},halfAMinute:"half a minute",lessThanXMinutes:{one:"less than a minute",other:"less than {{count}} minutes"},xMinutes:{one:"1 minute",other:"{{count}} minutes"},aboutXHours:{one:"about 1 hour",other:"about {{count}} hours"},xHours:{one:"1 hour",other:"{{count}} hours"},xDays:{one:"1 day",other:"{{count}} days"},aboutXWeeks:{one:"about 1 week",other:"about {{count}} weeks"},xWeeks:{one:"1 week",other:"{{count}} weeks"},aboutXMonths:{one:"about 1 month",other:"about {{count}} months"},xMonths:{one:"1 month",other:"{{count}} months"},aboutXYears:{one:"about 1 year",other:"about {{count}} years"},xYears:{one:"1 year",other:"{{count}} years"},overXYears:{one:"over 1 year",other:"over {{count}} years"},almostXYears:{one:"almost 1 year",other:"almost {{count}} years"}},Oe=function(n,e,t){var i,a=Ne[n];return i="string"==typeof a?a:1===e?a.one:a.other.replace("{{count}}",e.toString()),null!=t&&t.addSuffix?t.comparison&&t.comparison>0?"in "+i:i+" ago":i};function Ie(n){return function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.width?String(e.width):n.defaultWidth,i=n.formats[t]||n.formats[n.defaultWidth];return i}}var qe={date:Ie({formats:{full:"EEEE, MMMM do, y",long:"MMMM do, y",medium:"MMM d, y",short:"MM/dd/yyyy"},defaultWidth:"full"}),time:Ie({formats:{full:"h:mm:ss a zzzz",long:"h:mm:ss a z",medium:"h:mm:ss a",short:"h:mm a"},defaultWidth:"full"}),dateTime:Ie({formats:{full:"{{date}} 'at' {{time}}",long:"{{date}} 'at' {{time}}",medium:"{{date}}, {{time}}",short:"{{date}}, {{time}}"},defaultWidth:"full"})},Ue={lastWeek:"'last' eeee 'at' p",yesterday:"'yesterday at' p",today:"'today at' p",tomorrow:"'tomorrow at' p",nextWeek:"eeee 'at' p",other:"P"};function je(n){return function(e,t){var i,a=t||{};if("formatting"===(a.context?String(a.context):"standalone")&&n.formattingValues){var r=n.defaultFormattingWidth||n.defaultWidth,l=a.width?String(a.width):r;i=n.formattingValues[l]||n.formattingValues[r]}else{var o=n.defaultWidth,s=a.width?String(a.width):n.defaultWidth;i=n.values[s]||n.values[o]}return i[n.argumentCallback?n.argumentCallback(e):e]}}function Be(n){return function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},i=t.width,a=i&&n.matchPatterns[i]||n.matchPatterns[n.defaultMatchWidth],r=e.match(a);if(!r)return null;var l,o=r[0],s=i&&n.parsePatterns[i]||n.parsePatterns[n.defaultParseWidth],u=Array.isArray(s)?Ye(s,(function(n){return n.test(o)})):Pe(s,(function(n){return n.test(o)}));l=n.valueCallback?n.valueCallback(u):u,l=t.valueCallback?t.valueCallback(l):l;var c=e.slice(o.length);return{value:l,rest:c}}}function Pe(n,e){for(var t in n)if(n.hasOwnProperty(t)&&e(n[t]))return t}function Ye(n,e){for(var t=0;t<n.length;t++)if(e(n[t]))return t}var We,He={code:"en-US",formatDistance:Oe,formatLong:qe,formatRelative:function(n,e,t,i){return Ue[n]},localize:{ordinalNumber:function(n,e){var t=Number(n),i=t%100;if(i>20||i<10)switch(i%10){case 1:return t+"st";case 2:return t+"nd";case 3:return t+"rd"}return t+"th"},era:je({values:{narrow:["B","A"],abbreviated:["BC","AD"],wide:["Before Christ","Anno Domini"]},defaultWidth:"wide"}),quarter:je({values:{narrow:["1","2","3","4"],abbreviated:["Q1","Q2","Q3","Q4"],wide:["1st quarter","2nd quarter","3rd quarter","4th quarter"]},defaultWidth:"wide",argumentCallback:function(n){return n-1}}),month:je({values:{narrow:["J","F","M","A","M","J","J","A","S","O","N","D"],abbreviated:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],wide:["January","February","March","April","May","June","July","August","September","October","November","December"]},defaultWidth:"wide"}),day:je({values:{narrow:["S","M","T","W","T","F","S"],short:["Su","Mo","Tu","We","Th","Fr","Sa"],abbreviated:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],wide:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"]},defaultWidth:"wide"}),dayPeriod:je({values:{narrow:{am:"a",pm:"p",midnight:"mi",noon:"n",morning:"morning",afternoon:"afternoon",evening:"evening",night:"night"},abbreviated:{am:"AM",pm:"PM",midnight:"midnight",noon:"noon",morning:"morning",afternoon:"afternoon",evening:"evening",night:"night"},wide:{am:"a.m.",pm:"p.m.",midnight:"midnight",noon:"noon",morning:"morning",afternoon:"afternoon",evening:"evening",night:"night"}},defaultWidth:"wide",formattingValues:{narrow:{am:"a",pm:"p",midnight:"mi",noon:"n",morning:"in the morning",afternoon:"in the afternoon",evening:"in the evening",night:"at night"},abbreviated:{am:"AM",pm:"PM",midnight:"midnight",noon:"noon",morning:"in the morning",afternoon:"in the afternoon",evening:"in the evening",night:"at night"},wide:{am:"a.m.",pm:"p.m.",midnight:"midnight",noon:"noon",morning:"in the morning",afternoon:"in the afternoon",evening:"in the evening",night:"at night"}},defaultFormattingWidth:"wide"})},match:{ordinalNumber:(We={matchPattern:/^(\d+)(th|st|nd|rd)?/i,parsePattern:/\d+/i,valueCallback:function(n){return parseInt(n,10)}},function(n){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},t=n.match(We.matchPattern);if(!t)return null;var i=t[0],a=n.match(We.parsePattern);if(!a)return null;var r=We.valueCallback?We.valueCallback(a[0]):a[0];r=e.valueCallback?e.valueCallback(r):r;var l=n.slice(i.length);return{value:r,rest:l}}),era:Be({matchPatterns:{narrow:/^(b|a)/i,abbreviated:/^(b\.?\s?c\.?|b\.?\s?c\.?\s?e\.?|a\.?\s?d\.?|c\.?\s?e\.?)/i,wide:/^(before christ|before common era|anno domini|common era)/i},defaultMatchWidth:"wide",parsePatterns:{any:[/^b/i,/^(a|c)/i]},defaultParseWidth:"any"}),quarter:Be({matchPatterns:{narrow:/^[1234]/i,abbreviated:/^q[1234]/i,wide:/^[1234](th|st|nd|rd)? quarter/i},defaultMatchWidth:"wide",parsePatterns:{any:[/1/i,/2/i,/3/i,/4/i]},defaultParseWidth:"any",valueCallback:function(n){return n+1}}),month:Be({matchPatterns:{narrow:/^[jfmasond]/i,abbreviated:/^(jan|feb|mar|apr|may|jun|jul|aug|sep|oct|nov|dec)/i,wide:/^(january|february|march|april|may|june|july|august|september|october|november|december)/i},defaultMatchWidth:"wide",parsePatterns:{narrow:[/^j/i,/^f/i,/^m/i,/^a/i,/^m/i,/^j/i,/^j/i,/^a/i,/^s/i,/^o/i,/^n/i,/^d/i],any:[/^ja/i,/^f/i,/^mar/i,/^ap/i,/^may/i,/^jun/i,/^jul/i,/^au/i,/^s/i,/^o/i,/^n/i,/^d/i]},defaultParseWidth:"any"}),day:Be({matchPatterns:{narrow:/^[smtwf]/i,short:/^(su|mo|tu|we|th|fr|sa)/i,abbreviated:/^(sun|mon|tue|wed|thu|fri|sat)/i,wide:/^(sunday|monday|tuesday|wednesday|thursday|friday|saturday)/i},defaultMatchWidth:"wide",parsePatterns:{narrow:[/^s/i,/^m/i,/^t/i,/^w/i,/^t/i,/^f/i,/^s/i],any:[/^su/i,/^m/i,/^tu/i,/^w/i,/^th/i,/^f/i,/^sa/i]},defaultParseWidth:"any"}),dayPeriod:Be({matchPatterns:{narrow:/^(a|p|mi|n|(in the|at) (morning|afternoon|evening|night))/i,any:/^([ap]\.?\s?m\.?|midnight|noon|(in the|at) (morning|afternoon|evening|night))/i},defaultMatchWidth:"any",parsePatterns:{any:{am:/^a/i,pm:/^p/i,midnight:/^mi/i,noon:/^no/i,morning:/morning/i,afternoon:/afternoon/i,evening:/evening/i,night:/night/i}},defaultParseWidth:"any"})},options:{weekStartsOn:0,firstWeekContainsDate:1}};function Re(n){if(null===n||!0===n||!1===n)return NaN;var e=Number(n);return isNaN(e)?e:e<0?Math.ceil(e):Math.floor(e)}function ze(n,e){Fe(2,arguments);var t=Ee(n).getTime(),i=Re(e);return new Date(t+i)}function Qe(n,e){Fe(2,arguments);var t=Re(e);return ze(n,-t)}function Ge(n,e){for(var t=n<0?"-":"",i=Math.abs(n).toString();i.length<e;)i="0"+i;return t+i}var Ve={y:function(n,e){var t=n.getUTCFullYear(),i=t>0?t:1-t;return Ge("yy"===e?i%100:i,e.length)},M:function(n,e){var t=n.getUTCMonth();return"M"===e?String(t+1):Ge(t+1,2)},d:function(n,e){return Ge(n.getUTCDate(),e.length)},a:function(n,e){var t=n.getUTCHours()/12>=1?"pm":"am";switch(e){case"a":case"aa":return t.toUpperCase();case"aaa":return t;case"aaaaa":return t[0];default:return"am"===t?"a.m.":"p.m."}},h:function(n,e){return Ge(n.getUTCHours()%12||12,e.length)},H:function(n,e){return Ge(n.getUTCHours(),e.length)},m:function(n,e){return Ge(n.getUTCMinutes(),e.length)},s:function(n,e){return Ge(n.getUTCSeconds(),e.length)},S:function(n,e){var t=e.length,i=n.getUTCMilliseconds();return Ge(Math.floor(i*Math.pow(10,t-3)),e.length)}};function Xe(n){Fe(1,arguments);var e=1,t=Ee(n),i=t.getUTCDay(),a=(i<e?7:0)+i-e;return t.setUTCDate(t.getUTCDate()-a),t.setUTCHours(0,0,0,0),t}function Ke(n){Fe(1,arguments);var e=Ee(n),t=e.getUTCFullYear(),i=new Date(0);i.setUTCFullYear(t+1,0,4),i.setUTCHours(0,0,0,0);var a=Xe(i),r=new Date(0);r.setUTCFullYear(t,0,4),r.setUTCHours(0,0,0,0);var l=Xe(r);return e.getTime()>=a.getTime()?t+1:e.getTime()>=l.getTime()?t:t-1}function $e(n){Fe(1,arguments);var e=Ke(n),t=new Date(0);t.setUTCFullYear(e,0,4),t.setUTCHours(0,0,0,0);var i=Xe(t);return i}function Je(n,e){Fe(1,arguments);var t=e||{},i=t.locale,a=i&&i.options&&i.options.weekStartsOn,r=null==a?0:Re(a),l=null==t.weekStartsOn?r:Re(t.weekStartsOn);if(!(l>=0&&l<=6))throw new RangeError("weekStartsOn must be between 0 and 6 inclusively");var o=Ee(n),s=o.getUTCDay(),u=(s<l?7:0)+s-l;return o.setUTCDate(o.getUTCDate()-u),o.setUTCHours(0,0,0,0),o}function Ze(n,e){Fe(1,arguments);var t=Ee(n,e),i=t.getUTCFullYear(),a=e||{},r=a.locale,l=r&&r.options&&r.options.firstWeekContainsDate,o=null==l?1:Re(l),s=null==a.firstWeekContainsDate?o:Re(a.firstWeekContainsDate);if(!(s>=1&&s<=7))throw new RangeError("firstWeekContainsDate must be between 1 and 7 inclusively");var u=new Date(0);u.setUTCFullYear(i+1,0,s),u.setUTCHours(0,0,0,0);var c=Je(u,e),d=new Date(0);d.setUTCFullYear(i,0,s),d.setUTCHours(0,0,0,0);var p=Je(d,e);return t.getTime()>=c.getTime()?i+1:t.getTime()>=p.getTime()?i:i-1}function nt(n,e){Fe(1,arguments);var t=e||{},i=t.locale,a=i&&i.options&&i.options.firstWeekContainsDate,r=null==a?1:Re(a),l=null==t.firstWeekContainsDate?r:Re(t.firstWeekContainsDate),o=Ze(n,e),s=new Date(0);s.setUTCFullYear(o,0,l),s.setUTCHours(0,0,0,0);var u=Je(s,e);return u}var et="midnight",tt="noon",it="morning",at="afternoon",rt="evening",lt="night",ot={G:function(n,e,t){var i=n.getUTCFullYear()>0?1:0;switch(e){case"G":case"GG":case"GGG":return t.era(i,{width:"abbreviated"});case"GGGGG":return t.era(i,{width:"narrow"});default:return t.era(i,{width:"wide"})}},y:function(n,e,t){if("yo"===e){var i=n.getUTCFullYear(),a=i>0?i:1-i;return t.ordinalNumber(a,{unit:"year"})}return Ve.y(n,e)},Y:function(n,e,t,i){var a=Ze(n,i),r=a>0?a:1-a;return"YY"===e?Ge(r%100,2):"Yo"===e?t.ordinalNumber(r,{unit:"year"}):Ge(r,e.length)},R:function(n,e){return Ge(Ke(n),e.length)},u:function(n,e){return Ge(n.getUTCFullYear(),e.length)},Q:function(n,e,t){var i=Math.ceil((n.getUTCMonth()+1)/3);switch(e){case"Q":return String(i);case"QQ":return Ge(i,2);case"Qo":return t.ordinalNumber(i,{unit:"quarter"});case"QQQ":return t.quarter(i,{width:"abbreviated",context:"formatting"});case"QQQQQ":return t.quarter(i,{width:"narrow",context:"formatting"});default:return t.quarter(i,{width:"wide",context:"formatting"})}},q:function(n,e,t){var i=Math.ceil((n.getUTCMonth()+1)/3);switch(e){case"q":return String(i);case"qq":return Ge(i,2);case"qo":return t.ordinalNumber(i,{unit:"quarter"});case"qqq":return t.quarter(i,{width:"abbreviated",context:"standalone"});case"qqqqq":return t.quarter(i,{width:"narrow",context:"standalone"});default:return t.quarter(i,{width:"wide",context:"standalone"})}},M:function(n,e,t){var i=n.getUTCMonth();switch(e){case"M":case"MM":return Ve.M(n,e);case"Mo":return t.ordinalNumber(i+1,{unit:"month"});case"MMM":return t.month(i,{width:"abbreviated",context:"formatting"});case"MMMMM":return t.month(i,{width:"narrow",context:"formatting"});default:return t.month(i,{width:"wide",context:"formatting"})}},L:function(n,e,t){var i=n.getUTCMonth();switch(e){case"L":return String(i+1);case"LL":return Ge(i+1,2);case"Lo":return t.ordinalNumber(i+1,{unit:"month"});case"LLL":return t.month(i,{width:"abbreviated",context:"standalone"});case"LLLLL":return t.month(i,{width:"narrow",context:"standalone"});default:return t.month(i,{width:"wide",context:"standalone"})}},w:function(n,e,t,i){var a=function(n,e){Fe(1,arguments);var t=Ee(n),i=Je(t,e).getTime()-nt(t,e).getTime();return Math.round(i/6048e5)+1}(n,i);return"wo"===e?t.ordinalNumber(a,{unit:"week"}):Ge(a,e.length)},I:function(n,e,t){var i=function(n){Fe(1,arguments);var e=Ee(n),t=Xe(e).getTime()-$e(e).getTime();return Math.round(t/6048e5)+1}(n);return"Io"===e?t.ordinalNumber(i,{unit:"week"}):Ge(i,e.length)},d:function(n,e,t){return"do"===e?t.ordinalNumber(n.getUTCDate(),{unit:"date"}):Ve.d(n,e)},D:function(n,e,t){var i=function(n){Fe(1,arguments);var e=Ee(n),t=e.getTime();e.setUTCMonth(0,1),e.setUTCHours(0,0,0,0);var i=e.getTime(),a=t-i;return Math.floor(a/864e5)+1}(n);return"Do"===e?t.ordinalNumber(i,{unit:"dayOfYear"}):Ge(i,e.length)},E:function(n,e,t){var i=n.getUTCDay();switch(e){case"E":case"EE":case"EEE":return t.day(i,{width:"abbreviated",context:"formatting"});case"EEEEE":return t.day(i,{width:"narrow",context:"formatting"});case"EEEEEE":return t.day(i,{width:"short",context:"formatting"});default:return t.day(i,{width:"wide",context:"formatting"})}},e:function(n,e,t,i){var a=n.getUTCDay(),r=(a-i.weekStartsOn+8)%7||7;switch(e){case"e":return String(r);case"ee":return Ge(r,2);case"eo":return t.ordinalNumber(r,{unit:"day"});case"eee":return t.day(a,{width:"abbreviated",context:"formatting"});case"eeeee":return t.day(a,{width:"narrow",context:"formatting"});case"eeeeee":return t.day(a,{width:"short",context:"formatting"});default:return t.day(a,{width:"wide",context:"formatting"})}},c:function(n,e,t,i){var a=n.getUTCDay(),r=(a-i.weekStartsOn+8)%7||7;switch(e){case"c":return String(r);case"cc":return Ge(r,e.length);case"co":return t.ordinalNumber(r,{unit:"day"});case"ccc":return t.day(a,{width:"abbreviated",context:"standalone"});case"ccccc":return t.day(a,{width:"narrow",context:"standalone"});case"cccccc":return t.day(a,{width:"short",context:"standalone"});default:return t.day(a,{width:"wide",context:"standalone"})}},i:function(n,e,t){var i=n.getUTCDay(),a=0===i?7:i;switch(e){case"i":return String(a);case"ii":return Ge(a,e.length);case"io":return t.ordinalNumber(a,{unit:"day"});case"iii":return t.day(i,{width:"abbreviated",context:"formatting"});case"iiiii":return t.day(i,{width:"narrow",context:"formatting"});case"iiiiii":return t.day(i,{width:"short",context:"formatting"});default:return t.day(i,{width:"wide",context:"formatting"})}},a:function(n,e,t){var i=n.getUTCHours()/12>=1?"pm":"am";switch(e){case"a":case"aa":return t.dayPeriod(i,{width:"abbreviated",context:"formatting"});case"aaa":return t.dayPeriod(i,{width:"abbreviated",context:"formatting"}).toLowerCase();case"aaaaa":return t.dayPeriod(i,{width:"narrow",context:"formatting"});default:return t.dayPeriod(i,{width:"wide",context:"formatting"})}},b:function(n,e,t){var i,a=n.getUTCHours();switch(i=12===a?tt:0===a?et:a/12>=1?"pm":"am",e){case"b":case"bb":return t.dayPeriod(i,{width:"abbreviated",context:"formatting"});case"bbb":return t.dayPeriod(i,{width:"abbreviated",context:"formatting"}).toLowerCase();case"bbbbb":return t.dayPeriod(i,{width:"narrow",context:"formatting"});default:return t.dayPeriod(i,{width:"wide",context:"formatting"})}},B:function(n,e,t){var i,a=n.getUTCHours();switch(i=a>=17?rt:a>=12?at:a>=4?it:lt,e){case"B":case"BB":case"BBB":return t.dayPeriod(i,{width:"abbreviated",context:"formatting"});case"BBBBB":return t.dayPeriod(i,{width:"narrow",context:"formatting"});default:return t.dayPeriod(i,{width:"wide",context:"formatting"})}},h:function(n,e,t){if("ho"===e){var i=n.getUTCHours()%12;return 0===i&&(i=12),t.ordinalNumber(i,{unit:"hour"})}return Ve.h(n,e)},H:function(n,e,t){return"Ho"===e?t.ordinalNumber(n.getUTCHours(),{unit:"hour"}):Ve.H(n,e)},K:function(n,e,t){var i=n.getUTCHours()%12;return"Ko"===e?t.ordinalNumber(i,{unit:"hour"}):Ge(i,e.length)},k:function(n,e,t){var i=n.getUTCHours();return 0===i&&(i=24),"ko"===e?t.ordinalNumber(i,{unit:"hour"}):Ge(i,e.length)},m:function(n,e,t){return"mo"===e?t.ordinalNumber(n.getUTCMinutes(),{unit:"minute"}):Ve.m(n,e)},s:function(n,e,t){return"so"===e?t.ordinalNumber(n.getUTCSeconds(),{unit:"second"}):Ve.s(n,e)},S:function(n,e){return Ve.S(n,e)},X:function(n,e,t,i){var a=(i._originalDate||n).getTimezoneOffset();if(0===a)return"Z";switch(e){case"X":return ut(a);case"XXXX":case"XX":return ct(a);default:return ct(a,":")}},x:function(n,e,t,i){var a=(i._originalDate||n).getTimezoneOffset();switch(e){case"x":return ut(a);case"xxxx":case"xx":return ct(a);default:return ct(a,":")}},O:function(n,e,t,i){var a=(i._originalDate||n).getTimezoneOffset();switch(e){case"O":case"OO":case"OOO":return"GMT"+st(a,":");default:return"GMT"+ct(a,":")}},z:function(n,e,t,i){var a=(i._originalDate||n).getTimezoneOffset();switch(e){case"z":case"zz":case"zzz":return"GMT"+st(a,":");default:return"GMT"+ct(a,":")}},t:function(n,e,t,i){var a=i._originalDate||n;return Ge(Math.floor(a.getTime()/1e3),e.length)},T:function(n,e,t,i){return Ge((i._originalDate||n).getTime(),e.length)}};function st(n,e){var t=n>0?"-":"+",i=Math.abs(n),a=Math.floor(i/60),r=i%60;if(0===r)return t+String(a);var l=e||"";return t+String(a)+l+Ge(r,2)}function ut(n,e){return n%60==0?(n>0?"-":"+")+Ge(Math.abs(n)/60,2):ct(n,e)}function ct(n,e){var t=e||"",i=n>0?"-":"+",a=Math.abs(n);return i+Ge(Math.floor(a/60),2)+t+Ge(a%60,2)}var dt=ot;function pt(n,e){switch(n){case"P":return e.date({width:"short"});case"PP":return e.date({width:"medium"});case"PPP":return e.date({width:"long"});default:return e.date({width:"full"})}}function ft(n,e){switch(n){case"p":return e.time({width:"short"});case"pp":return e.time({width:"medium"});case"ppp":return e.time({width:"long"});default:return e.time({width:"full"})}}var ht={p:ft,P:function(n,e){var t,i=n.match(/(P+)(p+)?/),a=i[1],r=i[2];if(!r)return pt(n,e);switch(a){case"P":t=e.dateTime({width:"short"});break;case"PP":t=e.dateTime({width:"medium"});break;case"PPP":t=e.dateTime({width:"long"});break;default:t=e.dateTime({width:"full"})}return t.replace("{{date}}",pt(a,e)).replace("{{time}}",ft(r,e))}},gt=ht;function mt(n){var e=new Date(Date.UTC(n.getFullYear(),n.getMonth(),n.getDate(),n.getHours(),n.getMinutes(),n.getSeconds(),n.getMilliseconds()));return e.setUTCFullYear(n.getFullYear()),n.getTime()-e.getTime()}var _t=["D","DD"],yt=["YY","YYYY"];function bt(n){return-1!==_t.indexOf(n)}function vt(n){return-1!==yt.indexOf(n)}function wt(n,e,t){if("YYYY"===n)throw new RangeError("Use `yyyy` instead of `YYYY` (in `".concat(e,"`) for formatting years to the input `").concat(t,"`; see: https://git.io/fxCyr"));if("YY"===n)throw new RangeError("Use `yy` instead of `YY` (in `".concat(e,"`) for formatting years to the input `").concat(t,"`; see: https://git.io/fxCyr"));if("D"===n)throw new RangeError("Use `d` instead of `D` (in `".concat(e,"`) for formatting days of the month to the input `").concat(t,"`; see: https://git.io/fxCyr"));if("DD"===n)throw new RangeError("Use `dd` instead of `DD` (in `".concat(e,"`) for formatting days of the month to the input `").concat(t,"`; see: https://git.io/fxCyr"))}var kt=/[yYQqMLwIdDecihHKkms]o|(\w)\1*|''|'(''|[^'])+('|$)|./g,xt=/P+p+|P+|p+|''|'(''|[^'])+('|$)|./g,St=/^'([^]*?)'?$/,Ct=/''/g,Tt=/[a-zA-Z]/;function At(n){return n.match(St)[1].replace(Ct,"'")}var Lt=Object.freeze({__proto__:null,default:function(n,e,t){Fe(2,arguments);var i=String(e),a=t||{},r=a.locale||He,l=r.options&&r.options.firstWeekContainsDate,o=null==l?1:Re(l),s=null==a.firstWeekContainsDate?o:Re(a.firstWeekContainsDate);if(!(s>=1&&s<=7))throw new RangeError("firstWeekContainsDate must be between 1 and 7 inclusively");var u=r.options&&r.options.weekStartsOn,c=null==u?0:Re(u),d=null==a.weekStartsOn?c:Re(a.weekStartsOn);if(!(d>=0&&d<=6))throw new RangeError("weekStartsOn must be between 0 and 6 inclusively");if(!r.localize)throw new RangeError("locale must contain localize property");if(!r.formatLong)throw new RangeError("locale must contain formatLong property");var p=Ee(n);if(!De(p))throw new RangeError("Invalid time value");var f=mt(p),h=Qe(p,f),g={firstWeekContainsDate:s,weekStartsOn:d,locale:r,_originalDate:p},m=i.match(xt).map((function(n){var e=n[0];return"p"===e||"P"===e?(0,gt[e])(n,r.formatLong,g):n})).join("").match(kt).map((function(t){if("''"===t)return"'";var i=t[0];if("'"===i)return At(t);var l=dt[i];if(l)return!a.useAdditionalWeekYearTokens&&vt(t)&&wt(t,e,n),!a.useAdditionalDayOfYearTokens&&bt(t)&&wt(t,e,n),l(h,t,r.localize,g);if(i.match(Tt))throw new RangeError("Format string contains an unescaped latin alphabet character `"+i+"`");return t})).join("");return m}}),Ft=r(Lt);const Mt=o,Et=class{constructor(n,e,t,i,a,r){this.database=i,this.backupController=n,this.backupSettings=e,this.services=t,this.schema=a,this.backupLogger=r}async init(){}async getDirectusDatabasePath(){let n=await this.backupController.getDirectusRootFolderPath(),e=await this.backupSettings.getSQLITE3DBFilename();return Le.join(n,e)}async createBackup(n){await this.backupLogger.log("Start backup");let e=await this.getDirectusDatabasePath(),t=Le.join(n,"backup.db");await this.backupLogger.log("copy from: "+e),await this.backupLogger.log("copy to: "+t);try{Ae.copyFileSync(e,t)}catch(n){return console.log(n),null}return await this.backupLogger.log("Finished backup"),t}},Dt=i.default,Nt=a.default,Ot=Ft,It=class{constructor(n){this.backupSettings=n,this.currentLog=""}async resetLog(){this.currentLog="",await this.backupSettings.setLatestLog("")}async log(n){let e=new Date;this.currentLog=this.currentLog+"\n "+e.toISOString()+": "+n,await this.backupSettings.setLatestLog(this.currentLog)}},qt=process.env;const Ut=class{constructor(n,e,t){this.services=n,this.database=e,this.schema=t}getCollectionsService(){const{CollectionsService:n}=this.services;return new n({accountability:null,knex:this.database,schema:this.schema})}},jt=o,Bt=function(){return"version: 1\ndirectus: 9.18.1\ncollections:\n  - collection: auto_backup_settings\n    meta:\n      accountability: all\n      archive_app_filter: true\n      archive_field: null\n      archive_value: archived\n      collapse: open\n      collection: auto_backup_settings\n      color: null\n      display_template: null\n      group: null\n      hidden: false\n      icon: null\n      item_duplication_fields: null\n      note: null\n      singleton: true\n      sort: null\n      sort_field: null\n      translations: null\n      unarchive_value: draft\n    schema:\n      name: auto_backup_settings\n      sql: >-\n        CREATE TABLE \"auto_backup_settings\" (`DB_CLIENT` varchar(255) NULL\n        DEFAULT null, `active` boolean NULL DEFAULT '0', `backup_file_format`\n        varchar(255) NULL DEFAULT 'yyyy-MM-dd-HH-mm-SS-SSS',\n        `backup_location_custom_path` char(36) NULL DEFAULT\n        '/directus/database/backups', `backup_location_folder_id` char(36) NULL\n        DEFAULT null, `backup_location_folder_name` char(36) NULL DEFAULT\n        'backups', `backup_location_type` varchar(255) NULL DEFAULT\n        'file_library', `date_created` datetime NULL DEFAULT null,\n        `date_updated` datetime NULL DEFAULT null, `id` integer PRIMARY KEY\n        AUTOINCREMENT NOT NULL, `latest_log` text NULL DEFAULT null,\n        `sqlite3_db_filename` varchar(255) NULL DEFAULT\n        '/directus/database/data.db', `state` varchar(255) NULL DEFAULT\n        'finished', `user_created` varchar(36) NULL DEFAULT null, `user_updated`\n        varchar(36) NULL DEFAULT null, `backup_file_format_prefix` varchar(255)\n        NULL DEFAULT 'backup-', `backup_file_format_postfix` varchar(255) NULL\n        DEFAULT null)\nfields:\n  - collection: auto_backup_settings\n    field: DB_CLIENT\n    meta:\n      collection: auto_backup_settings\n      conditions: null\n      display: null\n      display_options: null\n      field: DB_CLIENT\n      group: general_settings\n      hidden: false\n      interface: select-dropdown\n      note: null\n      options:\n        allowNone: true\n        choices:\n          - text: sqlite3\n            value: sqlite3\n      readonly: false\n      required: false\n      sort: 9\n      special: null\n      translations: null\n      validation: null\n      validation_message: null\n      width: full\n    schema:\n      data_type: varchar\n      default_value: null\n      foreign_key_column: null\n      foreign_key_table: null\n      generation_expression: null\n      has_auto_increment: false\n      is_generated: false\n      is_nullable: true\n      is_primary_key: false\n      is_unique: false\n      max_length: 255\n      name: DB_CLIENT\n      numeric_precision: null\n      numeric_scale: null\n      table: auto_backup_settings\n    type: string\n  - collection: auto_backup_settings\n    field: active\n    meta:\n      collection: auto_backup_settings\n      conditions: null\n      display: null\n      display_options: null\n      field: active\n      group: null\n      hidden: false\n      interface: boolean\n      note: null\n      options: null\n      readonly: false\n      required: false\n      sort: 8\n      special:\n        - cast-boolean\n      translations: null\n      validation: null\n      validation_message: null\n      width: full\n    schema:\n      data_type: boolean\n      default_value: false\n      foreign_key_column: null\n      foreign_key_table: null\n      generation_expression: null\n      has_auto_increment: false\n      is_generated: false\n      is_nullable: true\n      is_primary_key: false\n      is_unique: false\n      max_length: null\n      name: active\n      numeric_precision: null\n      numeric_scale: null\n      table: auto_backup_settings\n    type: boolean\n  - collection: auto_backup_settings\n    field: backup_file_format\n    meta:\n      collection: auto_backup_settings\n      conditions: null\n      display: null\n      display_options: null\n      field: backup_file_format\n      group: driver_specific_settings\n      hidden: false\n      interface: input\n      note: >-\n        The default timestamp format will be: YYYY-MM-DD-HH-mm-ss-SSS. Customize\n        by using date-fns https://date-fns.org/v2.29.3/docs/format\n      options:\n        clear: true\n      readonly: false\n      required: false\n      sort: 6\n      special: null\n      translations: null\n      validation: null\n      validation_message: null\n      width: full\n    schema:\n      data_type: varchar\n      default_value: yyyy-MM-dd-HH-mm-SS-SSS\n      foreign_key_column: null\n      foreign_key_table: null\n      generation_expression: null\n      has_auto_increment: false\n      is_generated: false\n      is_nullable: true\n      is_primary_key: false\n      is_unique: false\n      max_length: 255\n      name: backup_file_format\n      numeric_precision: null\n      numeric_scale: null\n      table: auto_backup_settings\n    type: string\n  - collection: auto_backup_settings\n    field: backup_file_format_postfix\n    meta:\n      collection: auto_backup_settings\n      conditions: null\n      display: null\n      display_options: null\n      field: backup_file_format_postfix\n      group: driver_specific_settings\n      hidden: false\n      interface: input\n      note: A postfix for the filename of the backup.\n      options:\n        clear: true\n      readonly: false\n      required: false\n      sort: 5\n      special: null\n      translations: null\n      validation: null\n      validation_message: null\n      width: half\n    schema:\n      data_type: varchar\n      default_value: null\n      foreign_key_column: null\n      foreign_key_table: null\n      generation_expression: null\n      has_auto_increment: false\n      is_generated: false\n      is_nullable: true\n      is_primary_key: false\n      is_unique: false\n      max_length: 255\n      name: backup_file_format_postfix\n      numeric_precision: null\n      numeric_scale: null\n      table: auto_backup_settings\n    type: string\n  - collection: auto_backup_settings\n    field: backup_file_format_prefix\n    meta:\n      collection: auto_backup_settings\n      conditions: null\n      display: null\n      display_options: null\n      field: backup_file_format_prefix\n      group: driver_specific_settings\n      hidden: false\n      interface: input\n      note: A prefix for the filename of the backup.\n      options:\n        clear: true\n      readonly: false\n      required: false\n      sort: 4\n      special: null\n      translations: null\n      validation: null\n      validation_message: null\n      width: half\n    schema:\n      data_type: varchar\n      default_value: backup-\n      foreign_key_column: null\n      foreign_key_table: null\n      generation_expression: null\n      has_auto_increment: false\n      is_generated: false\n      is_nullable: true\n      is_primary_key: false\n      is_unique: false\n      max_length: 255\n      name: backup_file_format_prefix\n      numeric_precision: null\n      numeric_scale: null\n      table: auto_backup_settings\n    type: string\n  - collection: auto_backup_settings\n    field: backup_location_custom_path\n    meta:\n      collection: auto_backup_settings\n      conditions: null\n      display: null\n      display_options: null\n      field: backup_location_custom_path\n      group: backup_location_type_custom\n      hidden: false\n      interface: input\n      note: 'Absolute filepath (default: /directus/database/backups)'\n      options: null\n      readonly: false\n      required: false\n      sort: 1\n      special:\n        - file\n      translations: null\n      validation: null\n      validation_message: null\n      width: full\n    schema:\n      data_type: char\n      default_value: /directus/database/backups\n      foreign_key_column: null\n      foreign_key_table: null\n      generation_expression: null\n      has_auto_increment: false\n      is_generated: false\n      is_nullable: true\n      is_primary_key: false\n      is_unique: false\n      max_length: 36\n      name: backup_location_custom_path\n      numeric_precision: null\n      numeric_scale: null\n      table: auto_backup_settings\n    type: uuid\n  - collection: auto_backup_settings\n    field: backup_location_folder_id\n    meta:\n      collection: auto_backup_settings\n      conditions: null\n      display: null\n      display_options: null\n      field: backup_location_folder_id\n      group: backup_location_type_file_library\n      hidden: false\n      interface: input\n      note: 'Optional: ID of the folder (otherwise we will create it)'\n      options: null\n      readonly: false\n      required: false\n      sort: 1\n      special:\n        - file\n      translations: null\n      validation: null\n      validation_message: null\n      width: half\n    schema:\n      data_type: char\n      default_value: null\n      foreign_key_column: null\n      foreign_key_table: null\n      generation_expression: null\n      has_auto_increment: false\n      is_generated: false\n      is_nullable: true\n      is_primary_key: false\n      is_unique: false\n      max_length: 36\n      name: backup_location_folder_id\n      numeric_precision: null\n      numeric_scale: null\n      table: auto_backup_settings\n    type: uuid\n  - collection: auto_backup_settings\n    field: backup_location_folder_name\n    meta:\n      collection: auto_backup_settings\n      conditions: null\n      display: null\n      display_options: null\n      field: backup_location_folder_name\n      group: backup_location_type_file_library\n      hidden: false\n      interface: input\n      note: 'ReadOnly: Backup folder name'\n      options: null\n      readonly: true\n      required: false\n      sort: 2\n      special:\n        - file\n      translations: null\n      validation: null\n      validation_message: null\n      width: half\n    schema:\n      data_type: char\n      default_value: backups\n      foreign_key_column: null\n      foreign_key_table: null\n      generation_expression: null\n      has_auto_increment: false\n      is_generated: false\n      is_nullable: true\n      is_primary_key: false\n      is_unique: false\n      max_length: 36\n      name: backup_location_folder_name\n      numeric_precision: null\n      numeric_scale: null\n      table: auto_backup_settings\n    type: uuid\n  - collection: auto_backup_settings\n    field: backup_location_type\n    meta:\n      collection: auto_backup_settings\n      conditions: null\n      display: null\n      display_options: null\n      field: backup_location_type\n      group: general_settings\n      hidden: false\n      interface: select-dropdown\n      note: Select how/where backups should be saved\n      options:\n        allowNone: true\n        choices:\n          - text: File Library\n            value: file_library\n          - text: Custom Path\n            value: custom_path\n      readonly: false\n      required: false\n      sort: 4\n      special: null\n      translations: null\n      validation: null\n      validation_message: null\n      width: full\n    schema:\n      data_type: varchar\n      default_value: file_library\n      foreign_key_column: null\n      foreign_key_table: null\n      generation_expression: null\n      has_auto_increment: false\n      is_generated: false\n      is_nullable: true\n      is_primary_key: false\n      is_unique: false\n      max_length: 255\n      name: backup_location_type\n      numeric_precision: null\n      numeric_scale: null\n      table: auto_backup_settings\n    type: string\n  - collection: auto_backup_settings\n    field: backup_location_type_custom\n    meta:\n      collection: auto_backup_settings\n      conditions:\n        - name: Visible\n          rule:\n            _and:\n              - backup_location_type:\n                  _neq: custom_path\n          options: {}\n          hidden: true\n      display: null\n      display_options: null\n      field: backup_location_type_custom\n      group: general_settings\n      hidden: false\n      interface: group-raw\n      note: null\n      options: null\n      readonly: false\n      required: false\n      sort: 5\n      special:\n        - alias\n        - group\n        - no-data\n      translations: null\n      validation: null\n      validation_message: null\n      width: full\n    schema: null\n    type: alias\n  - collection: auto_backup_settings\n    field: backup_location_type_file_library\n    meta:\n      collection: auto_backup_settings\n      conditions:\n        - name: Vsisible\n          rule:\n            _and:\n              - backup_location_type:\n                  _neq: file_library\n          options: {}\n          hidden: true\n      display: null\n      display_options: null\n      field: backup_location_type_file_library\n      group: general_settings\n      hidden: false\n      interface: group-raw\n      note: null\n      options: null\n      readonly: false\n      required: false\n      sort: 6\n      special:\n        - alias\n        - group\n        - no-data\n      translations: null\n      validation: null\n      validation_message: null\n      width: full\n    schema: null\n    type: alias\n  - collection: auto_backup_settings\n    field: date_created\n    meta:\n      collection: auto_backup_settings\n      conditions: null\n      display: datetime\n      display_options:\n        relative: true\n      field: date_created\n      group: null\n      hidden: true\n      interface: datetime\n      note: null\n      options: null\n      readonly: true\n      required: false\n      sort: 3\n      special:\n        - cast-timestamp\n        - date-created\n      translations: null\n      validation: null\n      validation_message: null\n      width: half\n    schema:\n      data_type: datetime\n      default_value: null\n      foreign_key_column: null\n      foreign_key_table: null\n      generation_expression: null\n      has_auto_increment: false\n      is_generated: false\n      is_nullable: true\n      is_primary_key: false\n      is_unique: false\n      max_length: null\n      name: date_created\n      numeric_precision: null\n      numeric_scale: null\n      table: auto_backup_settings\n    type: timestamp\n  - collection: auto_backup_settings\n    field: date_updated\n    meta:\n      collection: auto_backup_settings\n      conditions: null\n      display: datetime\n      display_options:\n        relative: true\n      field: date_updated\n      group: null\n      hidden: true\n      interface: datetime\n      note: null\n      options: null\n      readonly: true\n      required: false\n      sort: 5\n      special:\n        - cast-timestamp\n        - date-updated\n      translations: null\n      validation: null\n      validation_message: null\n      width: half\n    schema:\n      data_type: datetime\n      default_value: null\n      foreign_key_column: null\n      foreign_key_table: null\n      generation_expression: null\n      has_auto_increment: false\n      is_generated: false\n      is_nullable: true\n      is_primary_key: false\n      is_unique: false\n      max_length: null\n      name: date_updated\n      numeric_precision: null\n      numeric_scale: null\n      table: auto_backup_settings\n    type: timestamp\n  - collection: auto_backup_settings\n    field: divide_to_database_type\n    meta:\n      collection: auto_backup_settings\n      conditions: null\n      display: null\n      display_options: null\n      field: divide_to_database_type\n      group: general_settings\n      hidden: false\n      interface: presentation-divider\n      note: null\n      options:\n        inlineTitle: true\n        title: Database driver\n      readonly: false\n      required: false\n      sort: 7\n      special:\n        - alias\n        - no-data\n      translations: null\n      validation: null\n      validation_message: null\n      width: full\n    schema: null\n    type: alias\n  - collection: auto_backup_settings\n    field: divider-oql-hz\n    meta:\n      collection: auto_backup_settings\n      conditions: null\n      display: null\n      display_options: null\n      field: divider-oql-hz\n      group: null\n      hidden: false\n      interface: presentation-divider\n      note: null\n      options: null\n      readonly: false\n      required: false\n      sort: 7\n      special:\n        - alias\n        - no-data\n      translations: null\n      validation: null\n      validation_message: null\n      width: full\n    schema: null\n    type: alias\n  - collection: auto_backup_settings\n    field: divider-qtbpzx\n    meta:\n      collection: auto_backup_settings\n      conditions: null\n      display: null\n      display_options: null\n      field: divider-qtbpzx\n      group: general_settings\n      hidden: false\n      interface: presentation-divider\n      note: null\n      options: null\n      readonly: false\n      required: false\n      sort: 11\n      special:\n        - alias\n        - no-data\n      translations: null\n      validation: null\n      validation_message: null\n      width: full\n    schema: null\n    type: alias\n  - collection: auto_backup_settings\n    field: divider_to_backup_location\n    meta:\n      collection: auto_backup_settings\n      conditions: null\n      display: null\n      display_options: null\n      field: divider_to_backup_location\n      group: general_settings\n      hidden: false\n      interface: presentation-divider\n      note: null\n      options:\n        inlineTitle: true\n        title: Backup location\n      readonly: false\n      required: false\n      sort: 2\n      special:\n        - alias\n        - no-data\n      translations: null\n      validation: null\n      validation_message: null\n      width: full\n    schema: null\n    type: alias\n  - collection: auto_backup_settings\n    field: driver_specific_settings\n    meta:\n      collection: auto_backup_settings\n      conditions:\n        - name: Visible\n          rule:\n            _and:\n              - DB_CLIENT:\n                  _null: true\n          hidden: true\n          options: {}\n      display: null\n      display_options: null\n      field: driver_specific_settings\n      group: general_settings\n      hidden: false\n      interface: group-raw\n      note: null\n      options: null\n      readonly: false\n      required: false\n      sort: 10\n      special:\n        - alias\n        - group\n        - no-data\n      translations: null\n      validation: null\n      validation_message: null\n      width: full\n    schema: null\n    type: alias\n  - collection: auto_backup_settings\n    field: general_settings\n    meta:\n      collection: auto_backup_settings\n      conditions:\n        - name: Open\n          rule:\n            _and:\n              - active:\n                  _neq: true\n          options:\n            start: open\n      display: null\n      display_options: null\n      field: general_settings\n      group: null\n      hidden: false\n      interface: group-detail\n      note: null\n      options:\n        start: closed\n      readonly: false\n      required: false\n      sort: 6\n      special:\n        - alias\n        - group\n        - no-data\n      translations: null\n      validation: null\n      validation_message: null\n      width: full\n    schema: null\n    type: alias\n  - collection: auto_backup_settings\n    field: id\n    meta:\n      collection: auto_backup_settings\n      conditions: null\n      display: null\n      display_options: null\n      field: id\n      group: null\n      hidden: true\n      interface: input\n      note: null\n      options: null\n      readonly: true\n      required: false\n      sort: 1\n      special: null\n      translations: null\n      validation: null\n      validation_message: null\n      width: full\n    schema:\n      data_type: integer\n      default_value: null\n      foreign_key_column: null\n      foreign_key_table: null\n      generation_expression: null\n      has_auto_increment: true\n      is_generated: false\n      is_nullable: false\n      is_primary_key: true\n      is_unique: false\n      max_length: null\n      name: id\n      numeric_precision: null\n      numeric_scale: null\n      table: auto_backup_settings\n    type: integer\n  - collection: auto_backup_settings\n    field: latest_log\n    meta:\n      collection: auto_backup_settings\n      conditions: null\n      display: null\n      display_options: null\n      field: latest_log\n      group: visibility_active\n      hidden: false\n      interface: input-multiline\n      note: null\n      options: null\n      readonly: false\n      required: false\n      sort: 1\n      special: null\n      translations: null\n      validation: null\n      validation_message: null\n      width: full\n    schema:\n      data_type: text\n      default_value: null\n      foreign_key_column: null\n      foreign_key_table: null\n      generation_expression: null\n      has_auto_increment: false\n      is_generated: false\n      is_nullable: true\n      is_primary_key: false\n      is_unique: false\n      max_length: null\n      name: latest_log\n      numeric_precision: null\n      numeric_scale: null\n      table: auto_backup_settings\n    type: text\n  - collection: auto_backup_settings\n    field: notice_finished\n    meta:\n      collection: auto_backup_settings\n      conditions: null\n      display: null\n      display_options: null\n      field: notice_finished\n      group: general_settings\n      hidden: false\n      interface: presentation-notice\n      note: null\n      options:\n        text: After this setup, you only need to active the next field ACTIVE\n      readonly: false\n      required: false\n      sort: 12\n      special:\n        - alias\n        - no-data\n      translations: null\n      validation: null\n      validation_message: null\n      width: full\n    schema: null\n    type: alias\n  - collection: auto_backup_settings\n    field: notice_please_configure_db_client\n    meta:\n      collection: auto_backup_settings\n      conditions: null\n      display: null\n      display_options: null\n      field: notice_please_configure_db_client\n      group: general_settings\n      hidden: false\n      interface: presentation-notice\n      note: null\n      options:\n        text: Please tell us which database client you are using.\n      readonly: false\n      required: false\n      sort: 8\n      special:\n        - alias\n        - no-data\n      translations: null\n      validation: null\n      validation_message: null\n      width: full\n    schema: null\n    type: alias\n  - collection: auto_backup_settings\n    field: notice_please_configure_save_location\n    meta:\n      collection: auto_backup_settings\n      conditions: null\n      display: null\n      display_options: null\n      field: notice_please_configure_save_location\n      group: general_settings\n      hidden: false\n      interface: presentation-notice\n      note: null\n      options:\n        text: >-\n          Please configure where your backup should be saved. You can either\n          save it in the directus FileLibrary or define a custom path.\n      readonly: false\n      required: false\n      sort: 3\n      special:\n        - alias\n        - no-data\n      translations: null\n      validation: null\n      validation_message: null\n      width: full\n    schema: null\n    type: alias\n  - collection: auto_backup_settings\n    field: notice_please_setup_name_for_backupfile\n    meta:\n      collection: auto_backup_settings\n      conditions: null\n      display: null\n      display_options: null\n      field: notice_please_setup_name_for_backupfile\n      group: driver_specific_settings\n      hidden: false\n      interface: presentation-notice\n      note: null\n      options:\n        text: >-\n          You can define the name of the backup file here. The name consist of\n          the prefix, timestamp and postfix.\n      readonly: false\n      required: false\n      sort: 1\n      special:\n        - alias\n        - no-data\n      translations: null\n      validation: null\n      validation_message: null\n      width: full\n    schema: null\n    type: alias\n  - collection: auto_backup_settings\n    field: notice_welcome\n    meta:\n      collection: auto_backup_settings\n      conditions: null\n      display: null\n      display_options: null\n      field: notice_welcome\n      group: general_settings\n      hidden: false\n      interface: presentation-notice\n      note: null\n      options:\n        text: >-\n          Welcome to the auto backup extension. Please configure this setup.\n          After that set the field ACTIVE to true\n      readonly: false\n      required: false\n      sort: 1\n      special:\n        - alias\n        - no-data\n      translations: null\n      validation: null\n      validation_message: null\n      width: full\n    schema: null\n    type: alias\n  - collection: auto_backup_settings\n    field: sqlite3_db_filename\n    meta:\n      collection: auto_backup_settings\n      conditions: null\n      display: null\n      display_options: null\n      field: sqlite3_db_filename\n      group: sqlite3_settings\n      hidden: false\n      interface: input\n      note: >-\n        Default from:\n        https://docs.directus.io/self-hosted/installation/docker.html\n      options: null\n      readonly: false\n      required: false\n      sort: 1\n      special: null\n      translations: null\n      validation: null\n      validation_message: null\n      width: full\n    schema:\n      data_type: varchar\n      default_value: /directus/database/data.db\n      foreign_key_column: null\n      foreign_key_table: null\n      generation_expression: null\n      has_auto_increment: false\n      is_generated: false\n      is_nullable: true\n      is_primary_key: false\n      is_unique: false\n      max_length: 255\n      name: sqlite3_db_filename\n      numeric_precision: null\n      numeric_scale: null\n      table: auto_backup_settings\n    type: string\n  - collection: auto_backup_settings\n    field: sqlite3_settings\n    meta:\n      collection: auto_backup_settings\n      conditions:\n        - rule:\n            _and:\n              - DB_CLIENT:\n                  _neq: sqlite3\n          readonly: false\n          hidden: true\n          required: false\n          options: {}\n          name: Visibility\n      display: null\n      display_options: null\n      field: sqlite3_settings\n      group: driver_specific_settings\n      hidden: false\n      interface: group-raw\n      note: null\n      options: null\n      readonly: false\n      required: false\n      sort: 7\n      special:\n        - alias\n        - group\n        - no-data\n      translations: null\n      validation: null\n      validation_message: null\n      width: full\n    schema: null\n    type: alias\n  - collection: auto_backup_settings\n    field: state\n    meta:\n      collection: auto_backup_settings\n      conditions: null\n      display: null\n      display_options: null\n      field: state\n      group: null\n      hidden: false\n      interface: select-dropdown\n      note: >-\n        If you want to run auto backups, just create a directus flow and change\n        the field 'state' to the value 'check'\n      options:\n        choices:\n          - text: create <-- manual start\n            value: create\n          - text: running\n            value: running\n          - text: finished\n            value: finished\n          - text: failed\n            value: failed\n      readonly: false\n      required: false\n      sort: 9\n      special: null\n      translations: null\n      validation: null\n      validation_message: null\n      width: full\n    schema:\n      data_type: varchar\n      default_value: finished\n      foreign_key_column: null\n      foreign_key_table: null\n      generation_expression: null\n      has_auto_increment: false\n      is_generated: false\n      is_nullable: true\n      is_primary_key: false\n      is_unique: false\n      max_length: 255\n      name: state\n      numeric_precision: null\n      numeric_scale: null\n      table: auto_backup_settings\n    type: string\n  - collection: auto_backup_settings\n    field: user_created\n    meta:\n      collection: auto_backup_settings\n      conditions: null\n      display: user\n      display_options: null\n      field: user_created\n      group: null\n      hidden: true\n      interface: select-dropdown-m2o\n      note: null\n      options:\n        template: '{{avatar.$thumbnail}} {{first_name}} {{last_name}}'\n      readonly: true\n      required: false\n      sort: 2\n      special:\n        - user-created\n      translations: null\n      validation: null\n      validation_message: null\n      width: half\n    schema:\n      data_type: varchar\n      default_value: null\n      foreign_key_column: null\n      foreign_key_table: null\n      generation_expression: null\n      has_auto_increment: false\n      is_generated: false\n      is_nullable: true\n      is_primary_key: false\n      is_unique: false\n      max_length: 36\n      name: user_created\n      numeric_precision: null\n      numeric_scale: null\n      table: auto_backup_settings\n    type: string\n  - collection: auto_backup_settings\n    field: user_updated\n    meta:\n      collection: auto_backup_settings\n      conditions: null\n      display: user\n      display_options: null\n      field: user_updated\n      group: null\n      hidden: true\n      interface: select-dropdown-m2o\n      note: null\n      options:\n        template: '{{avatar.$thumbnail}} {{first_name}} {{last_name}}'\n      readonly: true\n      required: false\n      sort: 4\n      special:\n        - user-updated\n      translations: null\n      validation: null\n      validation_message: null\n      width: half\n    schema:\n      data_type: varchar\n      default_value: null\n      foreign_key_column: null\n      foreign_key_table: null\n      generation_expression: null\n      has_auto_increment: false\n      is_generated: false\n      is_nullable: true\n      is_primary_key: false\n      is_unique: false\n      max_length: 36\n      name: user_updated\n      numeric_precision: null\n      numeric_scale: null\n      table: auto_backup_settings\n    type: string\n  - collection: auto_backup_settings\n    field: visibility_active\n    meta:\n      collection: auto_backup_settings\n      conditions:\n        - name: Visibility\n          rule:\n            _and:\n              - active:\n                  _eq: true\n          options: {}\n      display: null\n      display_options: null\n      field: visibility_active\n      group: null\n      hidden: false\n      interface: group-raw\n      note: null\n      options: null\n      readonly: false\n      required: false\n      sort: 10\n      special:\n        - alias\n        - group\n        - no-data\n      translations: null\n      validation: null\n      validation_message: null\n      width: full\n    schema: null\n    type: alias\nrelations: []\n"}(),Pt=s,Yt=class{constructor(n,e,t){this.database=e,this.services=n,this.schema=t,this.backupSettings=new Mt(n,e,t),this.finished=!0,this.filesService=this.getFileService(t,n),this.foldersService=this.getFolderService(t,n),this.logger=new It(this.backupSettings)}getFileService(n,e){return new e.FilesService({schema:n,accountability:null})}getFolderService(n,e){return new e.FoldersService({schema:n,accountability:null})}async init(){await this.backupSettings.init()}async getNewBackupFilenameWithoutExtension(n){let e=await this.backupSettings.getBackupFileFormatPrefix(),t=await this.backupSettings.getBackupFileFormatPostfix(),i=await this.backupSettings.getBackupFileFormat(),a=n||new Date,r=a.getFullYear()+"-"+(a.getMonth()+1)+"-"+a.getDate()+"-"+a.getHours()+"-"+a.getMinutes()+"-"+a.getSeconds()+"-"+a.getMilliseconds();try{r=Ot(a,i)}catch(n){await this.logger.log("Error: Could not format date but using default: "+n)}return e+r+t}async getDirectusRootFolderPath(){let n=Nt.join("/");return Nt.resolve(n)}async createFolderIfNotExists(n){Dt.existsSync(n)||Dt.mkdirSync(n,{recursive:!0})}async getTempFolderPath(){let n=await this.getDirectusRootFolderPath();return Nt.join(n,"directus","database","temp")}async deleteTempFolder(){let n=await this.getTempFolderPath();await this.logger.log("Delete temp folder: "+n),Dt.existsSync(n)&&Dt.rmSync(n,{recursive:!0}),await this.logger.log("Temp folder deleted")}getFileExtension(n){return Nt.extname(n)}async createOrGetFileLibraryFolder(n,e){if(e){await this.logger.log("Folder id set: "+e+" - check if folder exists");const t=await this.foldersService.readOne(e);return t?(await this.logger.log("Folder instance found: "+e+" - update folder name"),await this.backupSettings.setBackupLocationFileLibraryFolderName(t.name),e):(await this.logger.log("Folder instance not found: "+e+" - create folder"),await this.createOrGetFileLibraryFolder(n,null))}{await this.logger.log("Backup location folder id not set");const t=await this.foldersService.createOne({name:n});return await this.logger.log("Backup location folder created: "+t),(e=t)?(await this.logger.log("Backup location folder id set: "+e),await this.backupSettings.setBackupLocationFileLibraryFolderID(e),e):(console.log("Error: Could not create folder"),await this.logger.log("Error: Could not create folder"),null)}}getFileLibraryStorageLocation(){return(qt.STORAGE_LOCATIONS||"").split(",")[0]}async moveBackupFileToFilelibrary(n,e){await this.logger.log("Move backup file to file library");let t=await this.backupSettings.getBackupLocationFileLibraryFolderName(),i=await this.backupSettings.getBackupLocationFileLibraryFolderID(),a=await this.createOrGetFileLibraryFolder(t,i);if(!a)return await this.logger.log("Error: Could not create or get file library folder"),null;{let t={title:e,tags:["backup"],filename_download:e,filesize:Dt.statSync(n).size,folder:a,storage:this.getFileLibraryStorageLocation()},i=Dt.createReadStream(n);await this.logger.log("Upload backup file to file library"),await this.filesService.uploadOne(i,t),await this.logger.log("Backup file moved to file library")}}async moveBackupFileToCustomPath(n,e){await this.logger.log("Move backup file to custom path");let t=await this.backupSettings.getBackupLocationCustomPath();await this.logger.log("Create if not exists: "+t),await this.createFolderIfNotExists(t);let i=await this.getDirectusRootFolderPath(),a=Nt.join(i,t,e);try{return await this.logger.log("Move backup file to custom path: "+a),Dt.copyFileSync(n,a),await this.deleteTempFolder(),!0}catch(n){return console.log(n),await this.logger.log(n.toString()),await this.deleteTempFolder(),!1}}async moveBackupFileToFinalBackupFolder(n,e){await this.logger.log("Move backup file to backup folder");let t=this.getFileExtension(n),i=await this.getNewBackupFilenameWithoutExtension(e)+t;console.log("Backup filename: "+i),await this.logger.log("Backup filename: "+i);let a=await this.backupSettings.getBackupLocationType();console.log("Backup location type: "+a),await this.logger.log("Backup location type: "+a),this.backupSettings.isBackupLocationTypeFileLibrary(a)?await this.moveBackupFileToFilelibrary(n,i):this.backupSettings.isBackupLocationTypeCustomPath(a)&&await this.moveBackupFileToCustomPath(n,i)}async createBackup(){await this.logger.resetLog(),await this.logger.log("Init start backup");let n=await this.getTempFolderPath();await this.createFolderIfNotExists(n);let e=null,t=await this.backupSettings.getDBClient();if(this.backupSettings.isSQLITE3DBClient(t)&&(await this.logger.log("SQLITE3 DB Client selected"),e=new Et(this,this.backupSettings,this.services,this.database,this.schema,await this.logger),await e.init()),e){let t=new Date,i=await e.createBackup(n);i?(await this.logger.log("Backup created and temporarily stored at: "+i),await this.moveBackupFileToFinalBackupFolder(i,t),console.log("Moved backup file to backup folder finished"),await this.logger.log("Moved backup file to backup folder finished")):(console.log("Backup failed, since no backup file was created"),await this.logger.log("Backup failed, since no backup file was created"))}else console.log("No specific controller found for db client: "+t),await this.logger.log("No specific controller found for db client: "+t)}async checkIfBackup(){if(await this.backupSettings.getActiveStatus()){let n=await this.backupSettings.getState(),e="finished",t="running",i="failed";if(n==="create"&&this.finished){this.finished=!1,await this.backupSettings.setCurrentState(t);try{await this.createBackup(),this.finished=!0,await this.backupSettings.setCurrentState(e)}catch(n){await this.backupSettings.setLatestLog(n.toString()),this.finished=!0,await this.backupSettings.setCurrentState(i)}}else n===t||this.finished||await this.backupSettings.setCurrentState(t)}}},Wt=Pt.load(Bt);module.exports=async function({filter:n,action:e,init:t,schedule:i},{services:a,exceptions:r,database:l,getSchema:o,logger:s}){try{console.log("Init auto backup");let n=await o();await async function(n,e,t){let i=new Ut(n,e,t),a=await i.getCollectionsService();try{let n=await a.readByQuery(),e=!1;for(let t of n)if(t.collection===jt.TABLENAME){e=!0;break}if(!e){console.log("Collection "+jt.TABLENAME+" not found");let n=Wt.collections[0],e=Wt.fields;console.log("Creating "+jt.TABLENAME+" collection"),await a.createOne({...n,fields:e}),console.log("Created "+jt.TABLENAME+" collection")}}catch(n){console.log(n)}}(a,l,n);let t=new Yt(a,l,n);await t.init(),e(jt.TABLENAME+".items.update",(async(n,e)=>{try{await t.checkIfBackup()}catch(n){console.log(n)}}))}catch(n){n.toString().includes("no such table: directus_collections")?(console.log("++++++++++ Auto Backup +++++++++++"),console.log("++++ Database not initialized yet +++++"),console.log("++ Restart Server again after setup +++"),console.log("+++++++++++++++++++++++++++++++++++++++")):(console.log("Auto-Translation init error: "),console.log(n))}};
